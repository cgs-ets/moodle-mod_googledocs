{"version":3,"sources":["../src/save_quick_grading.js"],"names":["define","$","Ajax","Log","Notification","GoogledocSaveQuickGrading","debug","prototype","main","self","saveQuickGrading","refreshDateModified","onGradeChangeHandler","onCommentChangeHandler","on","listOfGrades","googledocid","attr","maxgrade","courseid","children","each","e","userid","grade","find","val","comment","length","rownumber","push","call","methodname","args","grades","JSON","stringify","done","response","parse","modifiedtimes","addNotification","message","type","fail","reason","error","forEach","currentText","eq","i","v","replace","parent","removeClass","html","timemodified","finalgrade","addClass","target","init","control"],"mappings":"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","sourcesContent":["// Standard license block omitted.\n/*\n * @package    mod_googledocs\n * @copyright  2020 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n \n /**\n  * @module mod_googledocs/update_controls\n  * define(['jquery', 'core/log', 'core/ajax', 'mod_googledocs/update_controls'], function ($, Log, Ajax, UpdateControl)\n  */\ndefine(['jquery', 'core/ajax', 'core/log', 'core/notification'], function($,Ajax, Log, Notification) {\n  'use strict';\n    /**\n     * Initializes the update controls.\n     */\n    function init() {\n        Log.debug('mod_googledocs/SaveQuickGrading: initializing SaveQuickGrading of the mod_googledocs');\n       \n        var control = new GoogledocSaveQuickGrading();\n        control.main();\n    }\n\n    // Constructor\n    function GoogledocSaveQuickGrading (){      \n        Log.debug(\"constructor\" );\n    };\n\n    GoogledocSaveQuickGrading.prototype.main = function() {\n        var self = this;\n        self.saveQuickGrading();\n        self.refreshDateModified;\n        self.onGradeChangeHandler();\n        self.onCommentChangeHandler();\n    };\n\n    GoogledocSaveQuickGrading.prototype.saveQuickGrading = function() {\n        var self = this;\n        $('button.submit-quickgrade').on('click', function () {\n\n            var listOfGrades = [];\n            var googledocid = $('table.gradetb').attr('data-googledocid');\n            var maxgrade = $('table.gradetb').attr('data-maxgrade');\n            var courseid = $('table.gradetb').attr('data-maxgrade');\n\n            $('tbody').children().each(function(e){\n                var userid = $(this).attr('data-user-id');\n                var grade = $(this).find(\"#quickgrade_\" + userid).val();\n                var comment = $(this).find(\"#quickgrade_comments_\" + userid).val();\n\n                if( grade.length == 0 && comment.length == 0) {\n                    return;\n                }\n\n                var grade = {\n                    userid : userid,\n                    grade : grade,\n                    comment: comment,\n                    googledocid: googledocid,\n                    rownumber: e,\n                    maxgrade:maxgrade,\n                    courseid:courseid\n                }\n                listOfGrades.push(grade);\n\n            });\n\n            Ajax.call([{\n                methodname: 'mod_googledocs_save_quick_grading',\n                args: {\n                    grades : JSON.stringify(listOfGrades)\n                },\n                done: function (response) {\n                    Log.debug(JSON.parse(response.modifiedtimes));\n                    self.refreshDateModified(JSON.parse(response.modifiedtimes));\n                    Notification.addNotification({\n                        message: 'The grade changes were saved',\n                        type: 'success'\n                    });\n                },\n                fail: function (reason) {\n                    Notification.addNotification({\n                        message: 'The grade changes were saved',\n                        type: 'info'\n                    });\n                    Log.error(reason);\n                }\n            }]);\n\n        });\n\n    };\n\n    GoogledocSaveQuickGrading.prototype.refreshDateModified = function(grades) {\n\n        grades.forEach((grade) => {\n            // tr is counting the header row too.\n            var currentText =  $( \"tr\" ).eq(grade.rownumber + 1).find('input.quickgrade').val();\n\n            $( \"tr\" ).eq(grade.rownumber + 1).find('input.quickgrade').val(function(i,v){\n                return v.replace(currentText, grade.grade);\n            });\n            $( \"tr\" ).eq(grade.rownumber + 1).find('input.quickgrade').parent().removeClass('quickgrademodified')\n            $( \"tr\" ).eq(grade.rownumber + 1).find('textarea.quickgrade').parent().removeClass('quickgrademodified');\n            $( \"tr\" ).eq( grade.rownumber + 1 ).find('td.timemod').html(grade.timemodified);\n            $( \"tr\" ).eq( grade.rownumber + 1 ).find('td.timemod').html(grade.timemodified);\n            $( \"tr\" ).eq( grade.rownumber + 1 ).find('td.finalgrade').html(grade.finalgrade);\n            $( \"tr\" ).eq( grade.rownumber + 1 ).find('div.submissionstatussubmitted ').html('Graded');\n            //submissionstatus \n            $( \"tr\" ).eq( grade.rownumber + 1 ).find('div.submissionstatus ').html('Graded').addClass('alert-success');;\n            \n        });\n    };\n    \n    GoogledocSaveQuickGrading.prototype.onGradeChangeHandler = function() {\n        $('input.quickgrade').on('change', function (e) {\n            var target = $(e.target)[0];\n            $(target).parent().addClass('quickgrademodified');\n        });\n    };\n    \n    GoogledocSaveQuickGrading.prototype.onCommentChangeHandler = function() {\n        $('textarea.quickgrade').on('change', function (e) {\n            var target = $(e.target)[0];\n            $(target).parent().addClass('quickgrademodified');\n        });\n    };\n\n    return {\n        init: init\n    };\n});"],"file":"save_quick_grading.min.js"}