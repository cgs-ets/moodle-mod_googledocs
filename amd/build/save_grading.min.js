define ("mod_googledocs/save_grading",["jquery","core/ajax","core/log","core/str","core/notification"],function(a,b,c,d,e){'use strict';function f(){this}f.prototype.main=function(){var a=this;a.get_users();a.saveGrading()};f.prototype.get_users=function(){var c=a("[data-region=\"user-selector\"]").find("[data-action=change-user]"),d=c.attr("data-googledocid"),f=c.attr("data-groupid");b.call([{methodname:"mod_googledocs_get_participants",args:{googledocid:d,groupid:f},done:this._setUsers.bind(this),fail:e.exception}]);return!0};f.prototype._setUsers=function(a){this.users=JSON.parse(a.users)};f.prototype.saveGrading=function(){var d=this,f;a("input[name=\"savechanges\"").click(function(){f=a(this).attr("name")});a("input[name=\"saveandshownext\"").click(function(){f=a(this).attr("name")});a("#gradeform").on("submit",function(g){var e=parseFloat(a("input").first().val());if(isNaN(e)||100<e||0>e){a("#id_error_grade").removeAttr("hidden");g.stopImmediatePropagation();return!1}else{a("[data-region=\"overlay\"]").show()}g.preventDefault();var h={userid:a("[data-region=\"user-info\"]").attr("data-userid"),googledocid:a("[data-region=\"user-info\"]").data("googledocid")+"",courseid:a("[data-region=\"googledoc-info\"]").data("courseid")+"",formdata:a(this).serialize()};b.call([{methodname:"mod_googledocs_save_quick_grading",args:{grade:JSON.stringify(h)},done:d._handleFormSubmissionResponse.bind(this,f,d),fail:function fail(a){c.error(a)}}])})};f.prototype._handleFormSubmissionResponse=function(b,c,f){var g=a("select.custom-select option:selected").next().val();console.log(f);d.get_strings([{key:"changessaved",component:"core"},{key:"gradechangessaveddetail",component:"mod_googledocs"}]).done(function(a){e.alert(a[0],a[1])}).fail(e.exception);if("savechanges"==b){if(""!=a(".grade-input").val()||"0.00"!=a(".grade-input").val()){a("span.gradedtag").removeAttr("hidden")}}else{c.get_next_user(g,c)}a("[data-region=\"overlay\"]").hide()};f.prototype.get_next_user=function(d,e){var f=a("[data-region=\"user-info\"]").attr("data-userid"),g=a("[data-region=\"user-info\"]").data("googledocid")+"";b.call([{methodname:"mod_googledocs_get_next_participant_details",args:{userid:d,googledocid:g},done:function done(b){c.debug("Grade values retrieved successfuly.");a(document).trigger("user-changed",d);a("select.custom-select option:selected").next().attr("selected","selected");a("select.custom-select option[value='".concat(f,"']")).removeAttr("selected");var g=new URL(window.location);g.searchParams.get("userid");g.searchParams.set("userid",d);window.history.replaceState({},"",g);e.refreshGradePanel(b.html)},fail:function fail(a){c.error("mod_googledocs_get_participant_by_id. Unable to get elements");c.debug(a)}}])};f.prototype.refreshGradePanel=function(b){var c=a("[data-region=\"grade\"]");c.fadeOut(300,function(){c.replaceWith(b);c.show();a("#gradeform").on("submit",f.prototype.saveGrading())})};return{init:function(){c.debug("mod_googledocs/SaveGrading: initializing SaveGrading of the mod_googledocs");var a=new f;a.main()}}});
//# sourceMappingURL=save_grading.min.js.map
