define ("mod_googledocs/grading_navigation_user_info",["jquery","core/notification","core/ajax","core/templates"],function(a,b,c,d){var e=function(b){console.log("UserInfo starts");console.log(b);this._regionSelector=b;this._region=a(b);this._userCache=[];if("[data-region=\"user-info\"]"==b){this._userid=a("[data-region=\"user-info\"]").data("userid");this._refreshUserInfo("e",this._userid);this._refreshUserSelector()}a(document).on("user-changed",this._refreshUserInfo.bind(this))};e.prototype._regionSelector=null;e.prototype._userCache=null;e.prototype._region=null;e.prototype._lastUserId=0;e.prototype._userid=0;e.prototype._getGoogledocId=function(){return this._region.attr("data-googledocid")};e.prototype._refreshUserSelector=function(){a("select.custom-select option[value='".concat(this._userid,"']")).attr("selected","selected")};e.prototype._refreshUserInfo=function(e,f){var g=a.Deferred();console.log("_refreshUserInfo");console.log(f);console.log("_lastUserId: ");console.log(this._lastUserId);this._region.attr("data-userid",f);if(this._lastUserId==f){return}this._lastUserId=f;d.render("mod_googledocs/loading",{}).done(function(e,h){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,e,h);this._region.fadeIn("fast")}.bind(this));if(0>f){d.render("mod_googledocs/grading_navigation_no_users",{}).done(function(a,b){if(f==this._lastUserId){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b);this._region.fadeIn("fast")}.bind(this))}}.bind(this)).fail(b.exception);return}if("undefined"!=typeof this._userCache[f]){g.resolve(this._userCache[f])}else{var i=this._getGoogledocId(),j=c.call([{methodname:"mod_googledocs_get_participant",args:{userid:f,googledocid:i}}]);j[0].done(function(a){if(!a.hasOwnProperty("id")){g.reject("No users")}else{this._userCache[f]=a;g.resolve(this._userCache[f])}}.bind(this)).fail(b.exception)}g.done(function(c){c.courseid=a("[data-region=\"grading-navigation-panel\"]").attr("data-courseid");if(c.user){c.identity=c.user.email;if(c.user.profileimageurl){c.profileimageurl=c.user.profileimageurl}}d.render("mod_googledocs/grading_navigation_user_summary",c).done(function(a,b){if(f==this._lastUserId){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b);this._region.fadeIn("fast")}.bind(this))}}.bind(this)).fail(b.exception)}.bind(this)).fail(function(){d.render("mod_googledocs/grading_navigation_no_users",{}).done(function(a,b){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b);this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(b.exception)}.bind(this))}.bind(this)).fail(b.exception)};return e});
//# sourceMappingURL=grading_navigation_user_info.min.js.map
