define ("mod_googledocs/create_controls",["jquery","core/log","core/ajax","mod_googledocs/delete_controls"],function(a,b,c,d){'use strict';function e(a,b,c,d,e,f,g,h){var i=this;i.parentfile_id=a;i.create=b;i.group_sharing=c;i.instance_id=d;i.grouping_sharing=e;i.files_to_erase=f;i.countCalls=g;i.dist_type=h}e.prototype.main=function(){var b=this;if(!b.create&&!b.group_sharing&&!b.grouping_sharing){b.callStudentFileService(b.parentfile_id)}else if(!b.create&&b.group_sharing&&!b.grouping_sharing){b.callGroupFileService()}else if(!b.create&&b.grouping_sharing&&!b.group_sharing){b.callGroupingFileService()}else{b.initTags()}a(document).ajaxStop(function(){a("tbody").children().each(function(){var b=a(this).find("#status_col");b.removeClass("progress_bar processing");b.html("Created");b.addClass("tag_doc success")});if(b.grouping_sharing){a("tbody.grouping-groups td.groups").each(function(){a(this).find("table").each(function(){var b=a(this).find("#file_grouping");b.removeClass("progress_bar processing");b.html("Created");b.addClass("tag_doc success")})});if(0<b.files_to_erase.length){b.delete_file_from_grouping()}}var c=a("tbody").children().length,e=a("table.overviewTable").attr("data-from-existing"),f=a("table.overviewTable").attr("data-googledoc-id");a("table.overviewTable").removeAttr("data-googledoc-id");if(b.countCalls==c&&f!=void 0&&0==e){b.files_to_erase.push(f);d.init(JSON.stringify(b.files_to_erase),b.dist_type);b.countCalls=0}})};e.prototype.initTags=function(){var b=this;a("tbody").children().each(function(c){if("#"!=a("#link_file_"+c).attr("href")){b.tagDisplay(c,!0)}else{b.tagDisplay(c,!1)}})};e.prototype.tagDisplay=function(b,c){this;if(!0===c){a("#file_"+b).html("Created");a("#file_"+b).addClass("tag_doc success")}else{a("#file_"+b).html("Failed");a("#file_"+b).addClass("tag_doc failed")}};e.prototype.delete_file_from_grouping=function(){var c=this,e=0,f=a("table.overviewTable").attr("data-from-existing");b.debug("Entro a delete_file_from_grouping");a("tbody.grouping-groups td.groups").each(function(){a(this).find("table").each(function(){e+=a(this).find("tbody").length-1})});if(c.countCalls==e&&0==f){d.init(JSON.stringify(c.files_to_erase));c.countCalls=0}};e.prototype.callStudentFileService=function(b){var c=this;a("tbody").children().each(function(d){var e=a(this).attr("data-student-id"),f=a(this).attr("data-student-email"),g=a(this).attr("student-name");c.create_student_file(d,e,f,g,b)})};e.prototype.callStudentFileServiceForGroup=function(b,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,f=this;a("tbody#group-members-"+c).children().each(function(g){var e=a(this).attr("data-student-id"),h=a(this).attr("data-student-email"),i=a(this).attr("student-name"),j=a(this).attr("student-group-id");if(j==c){f.create_student_file(g,e,h,i,b,f.group_sharing,j,f.grouping_sharing,d)}})};e.prototype.create_student_file=function(d,e,f,g,h){var i=5<arguments.length&&arguments[5]!==void 0?arguments[5]:!1,j=6<arguments.length&&arguments[6]!==void 0?arguments[6]:0,k=7<arguments.length&&arguments[7]!==void 0?arguments[7]:!1,l=8<arguments.length&&arguments[8]!==void 0?arguments[8]:0,m=this;if(!i){a("#file_"+d).addClass("progress_bar processing")}c.call([{methodname:"mod_googledocs_create_students_file",args:{by_group:i,by_grouping:k,group_id:j,grouping_id:l,instance_id:m.instance_id,parentfile_id:h,student_email:f,student_id:e,student_name:g},done:function done(c){b.debug(c.url);m.countCalls++;var e=a("#link_file_"+d);a(e).attr("href",c.url);if(!i){a("#file_"+d).removeClass("progress_bar processing");m.tagDisplay(d,!0)}},fail:function fail(c){b.error(c);a("#file_"+d).removeClass("progress_bar  processing");m.tagDisplay(d,!1)}}])};e.prototype.callGroupFileService=function(){var b=a("table.overviewTable").attr("data-owner-email"),c=this;a("tbody").find("[data-group-name]").each(function(){c.countCalls++;var d=a(this).attr("data-group-name"),e=a(this).attr("data-group-id"),f=a(this).find("#shared_link_url_"+e)[0];a(this).find("div#status_col").addClass("progress_bar processing");c.create_group_file(f,b,d,e)})};e.prototype.callGroupingFileService=function(){a("tbody.grouping-groups td.groups").each(function(){a(this).find("table").each(function(){a(this).find("#file_grouping").addClass("progress_bar processing")})});var b=a("table.groupingTable").attr("data-owner-email"),c=this;a("tbody").find("[data-grouping-name]").each(function(){var d=a(this).attr("data-grouping-name"),e=a(this).attr("data-grouping-id");c.create_grouping_file(d,e,b)});c.files_to_erase.push(a("table.groupingTable").attr("data-parentfile-id"))};e.prototype.create_group_file=function(d,e,f,g){var h=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,i=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,j=this;if(!j.grouping_sharing){h=j.parentfile_id}c.call([{methodname:"mod_googledocs_create_group_file",args:{group_name:f,group_id:g,grouping_id:i,instance_id:j.instance_id,owner_email:e,parentfile_id:h},done:function done(b){console.log(b);a(d).attr("href",b.url);j.callStudentFileServiceForGroup(b.googledocid,g)},fail:function fail(a){b.error(a)}}])};e.prototype.create_grouping_file=function(a,d,e){var f=this;c.call([{methodname:"mod_googledocs_create_grouping_file",args:{grouping_name:a,grouping_id:d,owner_email:e,parentfile_id:f.parentfile_id},done:function done(a){console.log(a);f.callGroupingGroupFileService(a.googledocid,d,a.url);f.files_to_erase.push(a.googledocid)},fail:function fail(a){b.error(a)}}])};e.prototype.callGroupingGroupFileService=function(b,c,d){var e=this;a("tbody.grouping-groups td.groups").each(function(){a(this).find("table").each(function(){var f=a(this),g=f.attr("data-group-id"),h=f.attr("data-owner-email"),i=f.attr("data-group-name"),j=f.find("#shared_link_"+c)[0];a(j).attr("href",d);if(f.attr("data-grouping-id")==c){e.create_group_file(j,h,i,g,b,c)}})})};return{init:function(c,d,f,g){b.debug("mod_googledocs/control: initializing delete controls of the mod_googledocs");var h;if(f){h=a("table.groupingTable").attr("data-parentfile-id")}else{h=a("table.overviewTable").attr("data-googledoc-id")}var i=a("table.overviewTable").attr("data-instance-id"),j=new e(h,c,d,i,f,[],0,g);j.main()}}});
//# sourceMappingURL=create_controls.min.js.map
