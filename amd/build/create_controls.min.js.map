{"version":3,"sources":["../src/create_controls.js"],"names":["define","$","Log","Ajax","DeleteControl","UpdateControl","GoogledocsControl","parentfile_id","create","instance_id","files_to_erase","countCalls","dist_type","group_folder_ids","self","prototype","main","initTags","callStudentFileService","callGroupFileService","callGroupingFileService","create_group_folder","debug","document","ajaxStop","children","each","tag","find","removeClass","html","addClass","from_existing","attr","length","delete_file_from_grouping","totalCalls","file_to_delete","removeAttr","push","init","JSON","stringify","e","tagDisplay","rownumber","creation","failedTag","group_id","student_id","student_email","student_name","create_student_file","callStudentFileServiceForGroup","grouping_id","student_group_id","student_grouping_id","folder_id","get_group_folder_id","call","methodname","args","folder_group_id","done","response","url","urls","parse","renderStudentLinks","ref","fail","reason","error","forEach","index","src","append","owner_email","group_name","groupid","a_element","create_group_file","grouping_name","create_grouping_file","grouping_sharing","append_links_to_icons","googledocid","console","log","callGroupingGroupFileService","links","t","link","get_grouping_url","g_ids","groups","split","i","includes","ids","append_links_helper","id","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googledocs/create_control module\n *\n * @package   mod_googledocs\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googledocs/control\n */\ndefine(['jquery', 'core/log', 'core/ajax', 'mod_googledocs/delete_controls', 'mod_googledocs/update_controls'], \nfunction ($, Log, Ajax, DeleteControl, UpdateControl) {\n    'use strict';\n    /**\n     * Initializes the controls.\n     */\n    function init(create, dist_type) {\n        Log.debug('mod_googledocs/update_control: initializing of the mod_googledocs control');\n        Log.debug(dist_type);\n\n        var parentfile_id;\n        var files_to_erase = []; // Collection of files ids to delete after copies are created\n\n        if (dist_type == 'grouping_copy') {\n            parentfile_id = $('table.groupingTable').attr('data-parentfile-id');\n        }else{\n            parentfile_id = $('table.overviewTable').attr('data-googledoc-id');\n        }\n\n        var instance_id = $('table.overviewTable').attr('data-instance-id');\n        var countCalls = 0;\n        var group_folder_ids;\n\n        var control = new GoogledocsControl(parentfile_id, create,  \n        instance_id, files_to_erase, countCalls, dist_type, group_folder_ids);\n\n        control.main();\n    }\n\n    // Constructor.\n    function GoogledocsControl( parentfile_id, create,  instance_id, \n     files_to_erase, countCalls, dist_type, group_folder_ids) {\n        var self = this;\n        self.parentfile_id = parentfile_id;\n        self.create = create;\n        self.instance_id = instance_id;\n        self.files_to_erase = files_to_erase;\n        self.countCalls = countCalls;\n        self.dist_type = dist_type;\n        self.group_folder_ids = group_folder_ids;\n\n    }\n\n    GoogledocsControl.prototype.main = function () {\n        var self = this;\n        \n        // Only call the create service if the files are not created.\n        // This JS is called in the view.php page, which calls the function\n        // that renders the table. It is the same table for created and processing\n        //when sharing by group or by bygrouping other WS is called\n\n\n        self.initTags();\n\n        switch(self.dist_type) {\n\n            case 'std_copy' :\n                if (!self.create) {\n                    self.callStudentFileService(self.parentfile_id);\n                }\n                break;\n\n            case 'group_copy' :\n                if (!self.create) {\n                    self.callGroupFileService();\n                }\n                break;\n\n            case 'grouping_copy' :\n                 if (!self.create) {\n                    self.callGroupingFileService();\n                }\n                break;\n\n            case 'std_copy_group_copy':\n                if(!self.create) {\n                   self.create_group_folder();\n                }\n                break;\n\n            case 'dist_share_same' :\n                if(!self.create) {\n                   Log.debug(\"dist_share_same \" + self.parentfile_id);\n                   self.callStudentFileService(self.parentfile_id);\n                }\n                break;\n\n            case 'dist_share_same_group_copy' :\n                if(!self.create) {\n                   self.create_group_folder();\n                }\n                break;\n            case 'dist_share_same_grouping_copy' :\n                if(!self.create) {\n                   self.create_group_folder();\n                }\n                break;\n            case 'std_copy_grouping_copy' :\n                if(!self.create) {\n                    self.create_group_folder();\n                }\n                break;\n            case 'std_copy_group_grouping_copy':\n                if(!self.create) {\n                    self.create_group_folder();\n                }\n                break;\n            case 'group_grouping_copy' :\n                if (!self.create) {\n                    self.callGroupFileService();\n                }\n                break;\n            case 'dist_share_same_group_grouping_copy' :\n                 if(!self.create) {\n                   self.create_group_folder();\n                  }\n                break;\n              \n\n\n        }\n        \n        \n\n        // When sharing by group or grouping. The same file is shared.\n        // The generation of this file might be quick, but giving the students\n        // a permission can take some time. In order for the entire sharing is done\n        // The progress bar is only removed when all the ajax calls finish.\n        $(document).ajaxStop(function() {\n\n           $('tbody').children().each(function(e){\n            var tag = $(this).find('#status_col');\n            tag.removeClass('spinner-border color');\n            tag.html('Created');\n            tag.addClass('tag_doc success');\n           });\n           \n           var from_existing = $('table.overviewTable').attr('data-from-existing');\n           \n            if(self.dist_type == 'grouping_copy'){\n\n               $('tbody.grouping-groups td.groups').each(function(){\n\n                $(this).find('table').each(function(){\n                    var tag = $(this).find(\"#file_grouping\");\n                    tag.removeClass('spinner-border color');\n                    tag.html('Created');\n                    tag.addClass('tag_doc success');\n                });\n             });\n\n                if(self.files_to_erase.length > 0  && from_existing == 0) {\n                    self.delete_file_from_grouping();\n                    self.files_to_erase = [];\n                }\n           }\n\n           // Once the students get their file or permission to access file\n           // delete the original file (when the file is created with the activity module)\n           // don't delete originals created with the \"Create from existing\" option.\n           //For group and students distribution is the same process.\n            var totalCalls = $('tbody').children().length;\n        \n            var file_to_delete = $('table.overviewTable').attr('data-googledoc-id');\n            //Log.debug(\"file_to_delete \" + file_to_delete);\n            //Log.debug('totalCalls ' + totalCalls);\n            //Log.debug('countCalls ' + self.countCalls);\n            $('table.overviewTable').removeAttr('data-googledoc-id');\n            \n            if(from_existing == 1 && self.countCalls == totalCalls\n                    && file_to_delete != undefined ) {\n               self.files_to_erase.push(file_to_delete);\n               UpdateControl.init(JSON.stringify(self.files_to_erase));\n               self.countCalls = 0;\n            }\n            \n            if (self.countCalls == totalCalls && file_to_delete != undefined \n                    && from_existing == 0 && self.dist_type != 'grouping_copy'){\n                self.files_to_erase.push(file_to_delete);\n                DeleteControl.init(JSON.stringify(self.files_to_erase), self.dist_type);\n                self.countCalls = 0;\n            }\n\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.initTags = function (){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            if ($('#link_file_' + e).attr('href') != '#'){\n                self.tagDisplay(e, self.create);\n            }else{\n                self.tagDisplay(e, self.create);\n            }\n        });\n\n    };\n\n\n    /**\n     *\n     * @param {int} rownumber\n     * @param  boolean creation\n     * @returns display created or failed on the table's status column.\n     */\n    GoogledocsControl.prototype.tagDisplay = function(rownumber, creation){\n        if(creation === true) {\n            $('#file_' + rownumber).html('Created');\n            $('#file_' + rownumber).addClass('tag_doc success');\n\n        }else{\n           // $('#file_' + rownumber).html('Failed');\n            $('#file_' + rownumber).addClass('spinner-border color');\n        }\n\n    };\n    \n    GoogledocsControl.prototype.failedTag = function (rownumber) {\n         $('#file_' + rownumber).html('Failed');\n    }\n\n    /**\n     * Example with file name Grouping_Share and groupings called Even and Odd respectively\n     * Even grouping has groups 2 and 4, Odd has groups 1 and 3\n     * Files created:\n     * 1. Grouping_Share \n     * 2. Grouping_share_odd\n     *     Grouping_Share_Grouping_share_odd_group_1\n     *       Grouping_Share_Grouping_share_odd_group_3\n     * 3. Grouping_share_even\n     *     Grouping_Share_Grouping_share_even_group_2\n     *       Grouping_Share_Grouping_share_even_group_4\n     *\n     * This function process the deletion of the following files:\n     *    Grouping_Share\n     *    Grouping_share_odd\n     *    Grouping_share_even\n     * @returns {undefined}\n     */\n    GoogledocsControl.prototype.delete_file_from_grouping = function () {\n        var self = this;\n        DeleteControl.init(JSON.stringify(self.files_to_erase), self.dist_type);\n        self.files_to_erase = [];\n        self.countCalls = 0;\n    };\n\n\n    GoogledocsControl.prototype.callStudentFileService = function(parentfile_id, group_id = 0 ){\n        var self = this;\n\n        Log.debug(\"callStudentFileService\");\n        $('tbody').children().each(function(e){\n\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            var group_id = $(this).attr('student-group-id');\n\n            self.create_student_file(e, student_id, student_email, student_name, parentfile_id, group_id);\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.callStudentFileServiceForGroup = function(parentfile_id, group_id, grouping_id = 0) {\n        var self = this;\n        Log.debug(\"Enters to: callStudentFileServiceForGroup\");\n        Log.debug(\"Parent file ID \" + parentfile_id + \"Group ID \" + group_id + \"Grouping ID \" + grouping_id);\n        $('tbody#group-members-'+group_id).children().each(function(e){\n\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            var student_group_id = $(this).attr('student-group-id');\n            if(student_group_id == group_id) {\n                self.create_student_file(e, student_id, student_email, student_name, parentfile_id,\n                                          student_group_id,  grouping_id );\n\n            }\n        });\n\n    };\n\n\n    GoogledocsControl.prototype.create_student_file = function (rownumber, student_id, student_email,student_name, parentfile_id, \n                                                                student_group_id = 0,\n                                                                student_grouping_id = 0 ) {\n        var self = this;\n        var folder_id = 0;\n\n        if(self.dist_type != 'group_copy') {\n           $('#file_' + rownumber).addClass('spinner-border color'); // progress bar visible. spinner-border\n        }\n\n        if(self.dist_type == 'std_copy_group_copy' || self.dist_type == 'std_copy_grouping_copy'\n                || self.dist_type == 'std_copy_group_grouping_copy') {\n            folder_id = self.get_group_folder_id(student_group_id, self.group_folder_ids);\n            Log.debug(\"create_student_file folder_id = \" + folder_id );\n        }\n\n\n        Ajax.call([{\n\n                methodname: 'mod_googledocs_create_students_file',\n\n                args: {\n                    folder_group_id: folder_id,\n                    group_id : student_group_id,\n                    grouping_id: student_grouping_id,\n                    instance_id : self.instance_id,\n                    parentfile_id: parentfile_id,\n                    student_email: student_email,\n                    student_id: student_id,\n                    student_name: student_name\n                },\n\n                done: function (response) {\n                    Log.debug(response.url);\n                    self.countCalls++;\n                    // Add file's link\n\n                    var urls = JSON.parse(response.url);\n\n                    if (self.dist_type == 'std_copy_group_copy' ||self.dist_type == 'std_copy_grouping_copy'\n                            || self.dist_type == 'std_copy_group_grouping_copy') {\n                        self.renderStudentLinks(urls, rownumber);\n                    }else{\n                        var ref = $('#' + 'link_file_' + rownumber);\n                        $(ref).attr(\"href\", urls[0]);\n                    }\n\n                    // Remove progress bar and display status\n                    if(self.dist_type != 'group_copy') {\n                        $('#file_' + rownumber).removeClass('spinner-border color');\n                        self.tagDisplay(rownumber, true);\n                    }\n\n                },\n\n                fail: function (reason) {\n                    Log.error(reason);\n                    $('#file_' + rownumber).removeClass('spinner-border color');\n                    $('#file_' + rownumber).addClass('failed');\n                    self.failedTag(rownumber);\n                }\n            }]);\n\n\n    };\n\n    // When dist. is each student from X group gets a copy. A student\n    // can get more than one copy. \n     GoogledocsControl.prototype.renderStudentLinks = function(urls, rownumber) {\n        urls.forEach(function(url, index){\n                       Log.debug('addLinks ' + rownumber);\n                        var ref = $('#' + 'link_file_' + rownumber);\n                        if(index === 0) {\n                           $(ref).attr(\"href\", url);\n                        }else{\n                           var src = $(ref).find(\"img\").attr(\"src\");\n                           $(ref).append('<a target=\"_blank\" id=\"link_file_' + rownumber +  '\"href=\"' + url + '\" class=\"link_icon\">\\n\\\n                            <img src=\"'+ src +'\" class=\"link_icon\"</a>');\n                        }\n                    }, rownumber);\n     }\n\n    GoogledocsControl.prototype.callGroupFileService = function (){\n\n        var owner_email = $('table.overviewTable').attr('data-owner-email');\n        var self = this;\n\n        $('tbody').find('[data-group-name]').each(function(){\n            self.countCalls++;\n            var group_name = $(this).attr('data-group-name');\n            var groupid =   $(this).attr('data-group-id');\n            var a_element = ($(this).find('#shared_link_url_' + groupid))[0]; //It is always the one element.\n           ($(this).find('div#status_col')).addClass('spinner-border color');\n            self.create_group_file(a_element, owner_email, group_name, groupid);\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.callGroupingFileService = function (){\n\n        $('tbody.grouping-groups td.groups').each(function(){\n           $(this).find('table').each(function(){\n                ($(this).find(\"#file_grouping\")).addClass('spinner-border color');\n           });\n        });\n\n        var owner_email = $('table.groupingTable').attr('data-owner-email');\n\n        var self = this;\n\n        $('tbody').find('[data-grouping-name]').each(function(){\n            var grouping_name = $(this).attr('data-grouping-name');\n            var grouping_id =   $(this).attr('data-grouping-id');\n            self.create_grouping_file (grouping_name, grouping_id, owner_email);\n        });\n    };\n\n    /**\n     * Creates the file FileName_Group_Name\n     * @param htmlElement a_element\n     * @param String owner_email\n     * @param String group_name\n     * @param int group_id\n     * @param int parentfile_id\n     * @param int grouping_id\n     *\n     */\n    GoogledocsControl.prototype.create_group_file = function(a_element = '' , owner_email, group_name = '', group_id, parentfile_id = 0,\n    grouping_id = 0){\n\n        var self = this;\n\n        if(!self.grouping_sharing) {\n            parentfile_id = self.parentfile_id;\n        }\n\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_group_file',\n            args: {\n                group_name: group_name,\n                group_id: group_id,\n                grouping_id: grouping_id,\n                instance_id: self.instance_id,\n                owner_email: owner_email,\n                parentfile_id: parentfile_id,\n            },\n            done: function (response) { \n                Log.debug(\"mod_googledocs_create_group_file \" + response);\n                if(self.dist_type == 'dist_share_same_group_copy' \n                        || self.dist_type == 'dist_share_same_grouping_copy'\n                        || self.dist_type == 'dist_share_same_group_grouping_copy') {\n                    self.append_links_to_icons(response.url); //  Traverse the list of students and add the link accoding to the group they belong to.                    \n                }else{\n                    // Add file's link\n                   $(a_element).attr(\"href\", response.url);\n                   //Returns the ID of the file created for the group.\n                   Log.debug('Group ID' + group_id)\n                   self.callStudentFileServiceForGroup(response.googledocid, group_id);\n                }\n               \n                self.files_to_erase.push(parentfile_id);\n\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n\n\n    };\n    /**\n     * Creates the file FileName_GroupingName\n     * @param String grouping_name\n     * @param  int grouping_id\n     * @param String owner_email\n     *\n     */\n    GoogledocsControl.prototype.create_grouping_file = function (grouping_name, grouping_id, owner_email) {\n        var self = this;\n\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_grouping_file',\n            args: {\n                grouping_name: grouping_name,\n                grouping_id: grouping_id,\n                owner_email: owner_email,\n                parentfile_id: self.parentfile_id,\n            },\n            done: function (response) {\n                console.log(response);\n                // Add file's link\n                //Returns the ID of the file created for the groups and the URL. \n                self.callGroupingGroupFileService(grouping_id, response.urls);\n                self.files_to_erase.push(response.googledocid);\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n    };\n\n   /**\n    * Creates the file FileName_GroupingName_GroupName\n    * @param int parentfile_id\n    * @param int grouping_id\n    * @param url url\n    *\n    */\n    GoogledocsControl.prototype.callGroupingGroupFileService = function(grouping_id, urls){\n        var  self = this;\n        var  links = JSON.parse(urls);\n\n       $('tbody.grouping-groups td.groups').each(function(e){\n\n            $(this).find('table').each(function(){\n                var t = $(this);\n                var group_id = t.attr('data-group-id');\n                var link = (t.find('#shared_link_' + grouping_id))[0];\n                var url = self.get_grouping_url(group_id, links);\n\n                $(link).attr(\"href\",url);\n\n            });\n\n        });\n    };\n\n    //Dist. Each student from a group gets a copy or each std. from a group share same copy. Create group folders\n    GoogledocsControl.prototype.create_group_folder = function(){\n        var self = this;\n\n        Ajax.call([{\n            methodname: 'mod_create_group_folder_struct',\n            args: {\n                instance_id: self.instance_id\n            },\n            done: function (response) {\n               Log.debug('mod_create_group_folder_struct');\n               self.group_folder_ids = JSON.parse(response.group_folder_ids);\n               \n               //Each student will get a copy\n               if(self.dist_type ==  'std_copy_group_copy' || self.dist_type == 'std_copy_grouping_copy'\n                       || self.dist_type == 'std_copy_group_grouping_copy') {\n                self.callStudentFileService(self.parentfile_id);\n               }\n               //Create the copy and the owner is the teacher.\n               if(self.dist_type == 'dist_share_same_group_copy' \n                       || self.dist_type == 'dist_share_same_grouping_copy'\n                       || self.dist_type == 'dist_share_same_group_grouping_copy') {\n                 \n                   var g_ids = $('table.overviewTable').attr('data-all-groups');\n                   var owner_email = $('table.overviewTable').attr('data-owner-email');\n                   self.create_group_file('',owner_email,'' ,g_ids, self.parentfile_id);\n               }\n              \n\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n    };\n\n    GoogledocsControl.prototype.get_group_folder_id = function (group_id, group_folder_ids) {\n        Log.debug(\"get_group_folder_id \" +  group_id + \" \" + group_folder_ids);\n        var groups = group_id.split('-');\n        for(var i = 0; i < group_folder_ids.length; i++) {\n            if (group_folder_ids[i].group_id == group_id || groups.includes(group_folder_ids[i].group_id)) {\n               return group_folder_ids[i].folder_id;\n               break;\n            }\n        }\n\n    };\n\n    GoogledocsControl.prototype.get_grouping_url = function (group_id, urls) {\n        Log.debug(\"get_grouping_url\");\n\n        for(var i= 0; i< urls.length; i++) {\n            if(urls[i].group_id == group_id){\n                return urls[i].url;\n                break;\n            }\n\n        }\n    };\n\n    GoogledocsControl.prototype.append_links_to_icons = function(urls) {\n        var self = this;\n        var links = JSON.parse(urls);\n\n        $('tbody').children().each(function(e){\n            self.countCalls++;\n            Log.debug('append_links_to_icons');\n\n            var group_id = $(this).attr('student-group-id');\n            Log.debug(group_id);\n            var ids = group_id.split(\"-\");\n            Log.debug(\"ids \" + ids);\n\n            self.append_links_helper(ids, links,e);\n\n            $('#file_' + e).removeClass('spinner-border color');\n             self.tagDisplay(e, true);\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.append_links_helper = function(ids, urls, rownumber) {\n        var self = this;\n        ids.forEach(function(id){\n            var ref = $('#' + 'link_file_' + rownumber);\n            var src = $(ref).find(\"img\").attr(\"src\");\n            var url = self.get_grouping_url(id, urls);\n            Log.debug(\"URL => \" + url );\n            if (url != undefined) {\n                if( $(ref).attr(\"href\") == \"#\"){\n                   $(ref).attr(\"href\", url);\n                }else{\n                    $(ref).append('<a target=\"_blank\" id=\"link_file_' + rownumber +  '\"href=\"' + url + '\" class=\"link_icon\">\\n\\\n                    <img src=\"'+ src +'\" class=\"link_icon\"</a>');\n                }\n            }\n\n        });\n    };\n    \n    \n\n    return {\n        init: init\n    };\n });"],"file":"create_controls.min.js"}