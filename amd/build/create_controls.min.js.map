{"version":3,"sources":["../src/create_controls.js"],"names":["define","$","Log","Ajax","DeleteControl","GoogledocsControl","parentfile_id","create","group_sharing","instance_id","grouping_sharing","files_to_erase","countCalls","self","prototype","main","callStudentFileService","callGroupFileService","callGroupingFileService","initTags","document","ajaxStop","children","each","tag","find","removeClass","html","addClass","length","delete_file_from_grouping","totalCalls","from_existing","attr","file_to_delete","removeAttr","push","init","JSON","stringify","e","tagDisplay","rownumber","creation","countTotal","debug","student_id","student_email","student_name","create_student_file","callStudentFileServiceForGroup","group_id","grouping_id","student_group_id","by_group","by_grouping","student_grouping_id","call","methodname","args","done","response","url","ref","fail","reason","error","owner_email","group_name","groupid","a_element","create_group_file","grouping_name","create_grouping_file","console","log","googledocid","callGroupingGroupFileService","t","link","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googledocs/create_control module\n *\n * @package   mod_googledocs\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googledocs/control\n */\ndefine(['jquery', 'core/log', 'core/ajax', 'mod_googledocs/delete_controls'], function ($, Log, Ajax, DeleteControl) {\n    'use strict';\n    /**\n     * Initializes the controls.\n     */\n    function init(create, group_sharing, grouping_sharing) {\n        Log.debug('mod_googledocs/control: initializing delete controls of the mod_googledocs');\n\n        var parentfile_id;\n        var files_to_erase = []; // Collection of files ids to delete after copies are created\n\n        if (grouping_sharing) {\n            parentfile_id = $('table.groupingTable').attr('data-parentfile-id');\n        }else{\n            parentfile_id = $('table.overviewTable').attr('data-googledoc-id');\n        }\n\n        var instance_id = $('table.overviewTable').attr('data-instance-id');\n        var countCalls = 0;\n        var control = new GoogledocsControl(parentfile_id, create, group_sharing, instance_id, grouping_sharing, files_to_erase, countCalls);\n\n        control.main();\n    }\n\n    // Constructor.\n    function GoogledocsControl( parentfile_id, create, group_sharing, instance_id, grouping_sharing, files_to_erase, countCalls) {\n        var self = this;\n        self.parentfile_id = parentfile_id;\n        self.create = create;\n        self.group_sharing = group_sharing;\n        self.instance_id = instance_id;\n        self.grouping_sharing = grouping_sharing;\n        self.files_to_erase = files_to_erase;\n        self.countCalls = countCalls;\n\n    }\n\n    GoogledocsControl.prototype.main = function () {\n        var self = this;\n\n        // Only call the create service if the files are not created.\n        // This JS is called in the view.php page, which calls the function\n        // that renders the table. It is the same table for created and processing\n        //when sharing by group or by bygrouping other WS is called\n\n        if(!self.create && !self.group_sharing && !self.grouping_sharing) {\n            self.callStudentFileService(self.parentfile_id);\n        }else if (!self.create && self.group_sharing && !self.grouping_sharing) {\n            self.callGroupFileService();\n        }else if(!self.create && self.grouping_sharing && !self.group_sharing) {\n            self.callGroupingFileService();\n        }else{\n              self.initTags();\n        }\n\n        // When sharing by group or grouping. The same file is shared.\n        // The generation of this file might be quick, but giving the students\n        // a permission can take some time. In order for the entire sharing is done\n        // The progress bar is only removed when all the ajax calls finish.\n        $(document).ajaxStop(function() {\n\n           $('tbody').children().each(function(e){\n            var tag = $(this).find('#status_col');\n            tag.removeClass('progress_bar processing');\n            tag.html('Created');\n            tag.addClass('tag_doc success');\n           });\n\n           if(self.grouping_sharing){\n\n               $('tbody.grouping-groups td.groups').each(function(){\n\n                $(this).find('table').each(function(){\n                    var tag = $(this).find(\"#file_grouping\");\n                    tag.removeClass('progress_bar processing');\n                    tag.html('Created');\n                    tag.addClass('tag_doc success');\n                });\n             });\n\n                if(self.files_to_erase.length > 0) {\n                    self.delete_file_from_grouping();\n                }\n           }\n\n           // Once the students get their file or permission to access file\n           // delete the original file (when the file is created with the activity module)\n           // don't delete originals created with the \"Create from existing\" option.\n           //For group and students distribution is the same process.\n            var totalCalls = $('tbody').children().length;\n            var from_existing = $('table.overviewTable').attr('data-from-existing');\n            var file_to_delete = $('table.overviewTable').attr('data-googledoc-id');\n            $('table.overviewTable').removeAttr('data-googledoc-id');\n\n            if (self.countCalls == totalCalls && file_to_delete != undefined && from_existing == 0){\n                self.files_to_erase.push(file_to_delete);\n                DeleteControl.init(JSON.stringify(self.files_to_erase));\n                self.countCalls = 0;\n            }\n            \n        });\n\n    };\n\n    GoogledocsControl.prototype.initTags = function (){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            if ($('#link_file_' + e).attr('href') != '#'){\n                self.tagDisplay(e, true);\n            }else{\n                self.tagDisplay(e, false);\n            }\n        });\n\n    };\n\n\n    /**\n     *\n     * @param {int} rownumber\n     * @param  boolean creation\n     * @returns display created or failed on the table's status column.\n     */\n    GoogledocsControl.prototype.tagDisplay = function(rownumber, creation){\n        var self = this;\n\n        if(creation === true) {\n            $('#file_' + rownumber).html('Created');\n            $('#file_' + rownumber).addClass('tag_doc success');\n      \n        }else{\n            $('#file_' + rownumber).html('Failed');\n            $('#file_' + rownumber).addClass('tag_doc failed');\n        }\n\n    };\n\n    /**\n     * Example with file name Grouping_Share and groupings called Even and Odd respectively\n     * Even grouping has groups 2 and 4, Odd has groups 1 and 3\n     * Files created:\n     * 1. Grouping_Share \n     * 2. Grouping_share_odd\n     *     Grouping_Share_Grouping_share_odd_group_1\n     *       Grouping_Share_Grouping_share_odd_group_3\n     * 3. Grouping_share_even\n     *     Grouping_Share_Grouping_share_even_group_2\n     *       Grouping_Share_Grouping_share_even_group_4\n     *\n     * This function process the deletion of the following files:\n     *    Grouping_Share\n     *    Grouping_share_odd\n     *    Grouping_share_even\n     * @returns {undefined}\n     */\n    GoogledocsControl.prototype.delete_file_from_grouping = function () {\n        var self = this;\n        var countTotal = 0;\n        var from_existing = $('table.overviewTable').attr('data-from-existing');\n        Log.debug(\"Entro a delete_file_from_grouping\");\n         $('tbody.grouping-groups td.groups').each(function(){\n                $(this).find('table').each(function(){\n                  countTotal += ($(this).find('tbody')).length - 1;\n\n                });\n         });\n         \n        if (self.countCalls == countTotal && from_existing == 0){\n                DeleteControl.init(JSON.stringify(self.files_to_erase));\n                self.countCalls = 0;\n        }\n\n       \n    };\n\n\n    GoogledocsControl.prototype.callStudentFileService = function(parentfile_id){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            self.create_student_file(e, student_id, student_email, student_name, parentfile_id);\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.callStudentFileServiceForGroup = function(parentfile_id, group_id, grouping_id = 0) {\n        var self = this;\n\n        $('tbody#group-members-'+group_id).children().each(function(e){\n\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            var student_group_id = $(this).attr('student-group-id');\n            if(student_group_id == group_id) {\n                self.create_student_file(e, student_id, student_email, student_name, parentfile_id,\n                                         self.group_sharing, student_group_id, self.grouping_sharing, grouping_id );\n             \n            }\n        });\n        \n\n    };\n\n\n    GoogledocsControl.prototype.create_student_file = function (rownumber, student_id, student_email,student_name, parentfile_id, \n                                                                by_group = false, student_group_id = 0, by_grouping = false,\n                                                                student_grouping_id = 0) {\n        var self = this;\n\n        if(!by_group) {\n           $('#file_' + rownumber).addClass('progress_bar processing'); // progress bar visible.\n        }\n\n        Ajax.call([{\n\n                methodname: 'mod_googledocs_create_students_file',\n\n                args: {\n                    by_group : by_group,\n                    by_grouping: by_grouping,\n                    group_id : student_group_id,\n                    grouping_id: student_grouping_id,\n                    instance_id : self.instance_id,\n                    parentfile_id: parentfile_id,\n                    student_email: student_email,\n                    student_id: student_id,\n                    student_name: student_name\n                },\n\n                done: function (response) {\n                    Log.debug(response.url);\n                    self.countCalls++;\n                    // Add file's link\n                    var ref = $('#' + 'link_file_' + rownumber);\n                    $(ref).attr(\"href\", response.url);\n                    // Remove progress bar and display status\n                    if(!by_group) {\n                        $('#file_' + rownumber).removeClass('progress_bar processing');\n                        self.tagDisplay(rownumber, true);\n                    }\n                },\n\n                fail: function (reason) {\n                    Log.error(reason);\n                    $('#file_' + rownumber).removeClass('progress_bar  processing');\n                    self.tagDisplay(rownumber, false);\n                }\n            }]);\n        \n     \n\n    };\n\n    GoogledocsControl.prototype.callGroupFileService = function (){\n\n        var owner_email = $('table.overviewTable').attr('data-owner-email');\n        var self = this;\n\n        $('tbody').find('[data-group-name]').each(function(e){\n            self.countCalls++;\n            var group_name = $(this).attr('data-group-name');\n            var groupid =   $(this).attr('data-group-id');\n            var a_element = ($(this).find('#shared_link_url_' + groupid))[0]; //It is always the one element.\n           ($(this).find('div#status_col')).addClass('progress_bar processing');\n            self.create_group_file(a_element, owner_email, group_name, groupid);\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.callGroupingFileService = function (){\n\n        $('tbody.grouping-groups td.groups').each(function(){\n           $(this).find('table').each(function(){\n                ($(this).find(\"#file_grouping\")).addClass('progress_bar processing');\n           });\n        });\n\n        var owner_email = $('table.groupingTable').attr('data-owner-email');\n\n        var self = this;\n\n        $('tbody').find('[data-grouping-name]').each(function(){\n            var grouping_name = $(this).attr('data-grouping-name');\n            var grouping_id =   $(this).attr('data-grouping-id');\n            self.create_grouping_file (grouping_name, grouping_id, owner_email);\n        });\n\n        self.files_to_erase.push( $('table.groupingTable').attr('data-parentfile-id'));\n\n    };\n    /**\n     * Creates the file FileName_Group_Name\n     * @param htmlElement a_element\n     * @param String owner_email\n     * @param String group_name\n     * @param int group_id\n     * @param int parentfile_id\n     * @param int grouping_id\n     *\n     */\n    GoogledocsControl.prototype.create_group_file = function(a_element ,owner_email, group_name, group_id, parentfile_id = 0,\n    grouping_id = 0){\n\n        var self = this;\n\n        if(!self.grouping_sharing) {\n            parentfile_id = self.parentfile_id;\n        }\n\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_group_file',\n            args: {\n                group_name: group_name,\n                group_id: group_id,\n                grouping_id: grouping_id,\n                instance_id: self.instance_id,\n                owner_email: owner_email,\n                parentfile_id: parentfile_id,\n            },\n            done: function (response) {\n                console.log(response);\n                 // Add file's link\n                $(a_element).attr(\"href\", response.url);\n                //Returns the ID of the file created for the group.\n                self.callStudentFileServiceForGroup(response.googledocid, group_id);\n\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n\n\n    };\n    /**\n     * Creates the file FileName_GroupingName\n     * @param String grouping_name\n     * @param  int grouping_id\n     * @param String owner_email\n     *\n     */\n    GoogledocsControl.prototype.create_grouping_file = function (grouping_name, grouping_id, owner_email) {\n        var self = this;\n\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_grouping_file',\n            args: {\n                grouping_name: grouping_name,\n                grouping_id: grouping_id,\n                owner_email: owner_email,\n                parentfile_id: self.parentfile_id,\n            },\n            done: function (response) {\n                console.log(response);\n                // Add file's link\n                //Returns the ID of the file created for the groups and the URL. \n                self.callGroupingGroupFileService(response.googledocid, grouping_id, response.url);\n                self.files_to_erase.push(response.googledocid);\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n    };\n\n   /**\n    * Creates the file FileName_GroupingName_GroupName\n    * @param int parentfile_id\n    * @param int grouping_id\n    * @param url url\n    *\n    */\n    GoogledocsControl.prototype.callGroupingGroupFileService = function(parentfile_id, grouping_id, url){\n        var self = this;\n\n       $('tbody.grouping-groups td.groups').each(function(){\n            $(this).find('table').each(function(){\n                var t = $(this);\n                var group_id = t.attr('data-group-id');\n                var owner_email = t.attr('data-owner-email');\n                var group_name = t.attr('data-group-name');\n                var link = (t.find('#shared_link_' + grouping_id))[0];\n                $(link).attr(\"href\",url);\n                if(t.attr('data-grouping-id') == grouping_id) {\n                    self.create_group_file(link, owner_email, group_name, group_id, parentfile_id, grouping_id );\n                }\n            });\n\n        });\n    };\n\n    return {\n        init: init\n    };\n });"],"file":"create_controls.min.js"}