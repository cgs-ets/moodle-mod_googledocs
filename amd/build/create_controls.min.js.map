{"version":3,"sources":["../src/create_controls.js"],"names":["define","$","Log","Ajax","DeleteControl","UpdateControl","GoogledocsControl","parentfile_id","create","instance_id","files_to_erase","countCalls","dist_type","group_folder_ids","isfoldertype","self","prototype","main","window","addEventListener","beforeunloadHandler","instancestat","JSON","parse","localStorage","getItem","setItem","stringify","instanceid","created","debug","callStudentFileService","children","each","e","tag","find","createdTagHandler","callGroupFileService","initGroupingTags","callGroupingFileService","create_group_folder","initGroupTags","shareSameGroupGroupingService","gid","attr","statuscol","removeClass","html","addClass","callGroupGroupingFileService","initGGTags","document","ajaxStop","from_existing","length","delete_file_from_grouping","totalCalls","file_to_update","removeAttr","console","log","push","init","removeEventListener","event","preventDefault","returnValue","initTags","tagDisplay","rownumber","creation","failedTag","group_id","student_id","student_email","student_name","dist","create_student_file","callStudentFileServiceForGroup","grouping_id","student_group_id","student_grouping_id","folder_id","get_group_folder_id","call","methodname","args","folder_group_id","done","response","url","urls","renderStudentLinks","ref","update_local_storage","fail","reason","error","forEach","index","src","append","owner_email","group_name","groupid","a_element","create_group_file","create_grouping_file","owneremail","gname","gtype","aelement","create_group_grouping_file","grouping_sharing","append_links_to_icons","googledocid","parentfileid","id","get_grouping_url","groupingsurl","g_ids","groups","split","i","includes","get_grouping_url_for_student","ids","links","append_links_helper","instancecreated","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googledocs/create_control module\n *\n * @package   mod_googledocs\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googledocs/controls\n */\ndefine(['jquery', 'core/log', 'core/ajax', 'mod_googledocs/delete_controls', 'mod_googledocs/update_controls'], function ($, Log, Ajax, DeleteControl, UpdateControl) {\n    'use strict';\n    /**\n     * Initializes the controls.\n     */\n    function init(create, dist_type) {\n        Log.debug('mod_googledocs/update_control: initializing of the mod_googledocs control');\n        Log.debug(dist_type);\n        Log.debug(create);\n\n        var parentfile_id = $('table.overviewTable').attr('data-googledocs-id');\n        var files_to_erase = []; // Collection of files ids to delete after copies are created\n        var instance_id = $('table.overviewTable').attr('data-instance-id');\n        var isfoldertype = $('table.overviewTable').attr('data-isfolder');\n        var countCalls = 0;\n        var group_folder_ids;\n\n        var control = new GoogledocsControl(parentfile_id, create, instance_id,\n            files_to_erase, countCalls, dist_type, group_folder_ids, isfoldertype);\n\n        control.main();\n    }\n\n    // Constructor.\n    function GoogledocsControl(parentfile_id, create, instance_id,\n        files_to_erase, countCalls, dist_type, group_folder_ids, isfoldertype) {\n\n        var self = this;\n        self.parentfile_id = parentfile_id;\n        self.create = create;\n        self.instance_id = instance_id;\n        self.files_to_erase = files_to_erase;\n        self.countCalls = countCalls;\n        self.dist_type = dist_type;\n        self.group_folder_ids = group_folder_ids;\n        self.isfoldertype = isfoldertype;\n\n    }\n\n    GoogledocsControl.prototype.main = function () {\n        var self = this;\n        if (!self.create) {\n            window.addEventListener('beforeunload', self.beforeunloadHandler);\n        }\n\n\n        // Only call the create service if the files are not created.\n        // This JS is called in the view.php page, which calls the function\n        // that renders the table. It is the same table for created and processing\n        //when sharing by group or by bygrouping other WS is called\n\n        let instancestat = JSON.parse(localStorage.getItem('instance'));\n\n        if (instancestat == null) {\n            //Store the instance creation in session storage. This will live as long as the browser is open. \n            // Used to control duplicates. \n            localStorage.setItem('instance', JSON.stringify({\n                instanceid: self.instance_id,\n                created: 0\n            }));\n        } else {\n\n            // check if the instance id\n            instancestat = JSON.parse(localStorage.getItem('instance'));\n\n            if (instancestat.instanceid != self.instance_id) { // its another one\n\n                localStorage.setItem('instance', JSON.stringify({\n                    instanceid: self.instance_id,\n                    created: 0\n                }));\n            }\n        }\n\n        instancestat = JSON.parse(localStorage.getItem('instance'));\n        Log.debug(instancestat);\n\n        switch (self.dist_type) {\n\n            case 'std_copy':\n                if (!self.create && instancestat.created == 0) {\n                    self.callStudentFileService(self.parentfile_id);\n                } else {\n                    $('tbody').children().each(function (e) {\n                        var tag = $(this).find('#file_' + e);\n                        self.createdTagHandler(tag);\n                    });\n\n                }\n                break;\n            case 'group_copy':\n                if (!self.create && instancestat.created == 0) {\n                    self.callGroupFileService();\n                } else {\n                    $('tbody').children().each(function () {\n                        var tag = $(this).find('#status_col');\n                        self.createdTagHandler(tag);\n                    });\n                }\n                break;\n            case 'grouping_copy':\n                self.initGroupingTags();\n                if (!self.create && instancestat.created == 0) {\n                    self.callGroupingFileService();\n                } else {\n                    $('tbody').children().each(function (e) {\n                        var tag = $(this).find('#status_col_' + e);\n                        self.createdTagHandler(tag);\n                    });\n                }\n                break;\n            case 'std_copy_group':\n                if (!self.create && instancestat.created == 0) {\n                    self.create_group_folder();\n                } else {\n                    $('tbody').children().each(function (e) {\n                        var tag = $(this).find('#file_' + e);\n                        self.createdTagHandler(tag);\n                    });\n                }\n                break;\n            case 'dist_share_same':\n                if (!self.create && instancestat.created == 0) {\n                    self.callStudentFileService(self.parentfile_id);\n                } else {\n                    $('tbody').children().each(function (e) {\n                        var tag = $(this).find('#file_' + e);\n                        self.createdTagHandler(tag);\n                    });\n                }\n                break;\n\n            case 'dist_share_same_group':\n                if (!self.create && instancestat.created == 0) {\n                    self.initGroupTags();\n                    self.shareSameGroupGroupingService();\n                }\n                break;\n            case 'dist_share_same_grouping':\n                self.initGroupingTags();\n                if (!self.create && instancestat.created == 0) {\n                    self.callGroupingFileService(self.parentfile_id);\n                } else {\n                    $('tbody').find('[data-grouping-name]').each(function () {\n                        var gid = $(this).attr('data-grouping-id');\n                        var statuscol = ($(this).find('div#status_col_' + gid));\n                        $('div#status_col_' + gid).removeClass('spinner-border color');\n                        $(statuscol).html('Created');\n                        $(statuscol).addClass('status-access');\n                    });\n                }\n                break;\n            case 'std_copy_grouping':\n                if (!self.create && instancestat.created == 0) {\n                    self.create_group_folder();\n                } else {\n                    $('tbody').children().each(function (e) {\n                        var tag = $(this).find('#file_' + e);\n                        self.createdTagHandler(tag);\n                    });\n                }\n                break;\n            case 'std_copy_group_grouping':\n                if (!self.create && instancestat.created == 0) {\n                    self.create_group_folder();\n                } else {\n                    $('tbody').children().each(function (e) {\n                        var tag = $(this).find('#file_' + e);\n                        self.createdTagHandler(tag);\n                    });\n                }\n                break;\n            case 'group_grouping_copy':\n                if (!self.create && instancestat.created == 0) {\n                    self.callGroupGroupingFileService();\n                } else {\n                    self.initGGTags();\n                }\n                break;\n            case 'dist_share_same_group_grouping':\n                if (!self.create && instancestat.created == 0) {\n                    self.callGroupGroupingFileService();\n                } else {\n                    self.initGGTags();\n                }\n                break;\n\n        }\n\n        // When sharing by group or grouping. The same file is shared.\n        // The generation of this file might be quick, but giving the students\n        // a permission can take some time. In order for the entire sharing is done\n        // The progress bar is only removed when all the ajax calls finish.\n        $(document).ajaxStop(function () {\n\n\n            $('tbody').children().each(function () {\n                var tag = $(this).find('#status_col');\n                self.createdTagHandler(tag);\n            });\n\n            var from_existing = $('table.overviewTable').attr('data-from-existing');\n\n            if (self.dist_type == 'grouping_copy') {\n\n                $('tbody.grouping-groups td.groups').each(function () {\n\n                    $(this).find('table').each(function () {\n                        var tag = $(this).find(\"#file_grouping\");\n                        self.createdTagHandler(tag);\n                    });\n                });\n\n                if (self.files_to_erase.length > 0 && from_existing == 0) {\n                    self.delete_file_from_grouping();\n                    self.files_to_erase = [];\n                }\n            }\n\n            // Once the students get their file or permission to access file\n            // delete the original file (when the file is created with the activity module)\n            // don't delete originals created with the \"Create from existing\" option.\n            //For group and students distribution is the same process.\n            var totalCalls = $('tbody').children().length;\n            var file_to_update = $('table.overviewTable').attr('data-googledocs-id');\n\n            $('table.overviewTable').removeAttr('data-googledocs-id');\n            console.log('TOTAL CALLS TO DO', totalCalls);\n            console.log('self.countCalls', self.countCalls);\n\n            if (from_existing == 1 && self.countCalls == totalCalls\n                && file_to_update != undefined) {\n                self.files_to_erase.push(file_to_update);\n                console.log(\"instance_id\", self.instance_id);\n                UpdateControl.init(JSON.stringify(self.files_to_erase), self.instance_id);\n                self.countCalls = 0;\n            }\n\n            if (self.dist_type == 'group_grouping_copy' && self.countCalls == totalCalls) {\n                self.files_to_erase.push(file_to_update);\n                DeleteControl.init(JSON.stringify(self.files_to_erase), self.dist_type);\n                self.countCalls = 0;\n            }\n\n            if (self.countCalls == totalCalls && file_to_update != undefined\n                && from_existing == 0) { //&& self.dist_type != 'grouping_copy'\n                self.files_to_erase.push(file_to_update);\n                DeleteControl.init(JSON.stringify(self.files_to_erase), self.dist_type);\n                self.countCalls = 0;\n            }\n            //Remove alert when trying to leave the page, after all files were created\n            window.removeEventListener('beforeunload', self.beforeunloadHandler, false);\n\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.createdTagHandler = function (tag) {\n        tag.removeClass('spinner-border color');\n        tag.html('Created');\n        tag.addClass('status-access');\n    };\n\n    // Triggers when user tries to leave the page and documents are being created.\n    GoogledocsControl.prototype.beforeunloadHandler = function (event, created) {\n        event.preventDefault();\n        event.returnValue = '';\n    };\n\n    GoogledocsControl.prototype.initTags = function () {\n        var self = this;\n        $('tbody').children().each(function (e) {\n            if ($('#link_file_' + e).attr('href') != '#') {\n                self.tagDisplay(e, self.create);\n            } else {\n                self.tagDisplay(e, self.create);\n            }\n        });\n    };\n\n    GoogledocsControl.prototype.initGGTags = function () {\n\n        $('tbody').find('[data-g-name]').each(function () {\n            var gid = $(this).attr('data-g-id');\n            var statuscol = ($(this).find('div#status_col_' + gid));\n            $(statuscol).html('Created');\n            $(statuscol).addClass('status-access');\n        });\n    };\n\n    GoogledocsControl.prototype.initGroupingTags = function () {\n        var self = this;\n\n        $('tbody').find('[data-grouping-name]').each(function () {\n            var gid = $(this).attr('data-grouping-id');\n            var statuscol = ($(this).find('div#status_col_' + gid));\n            if (self.create) {\n                $(statuscol).html('Created');\n                $(statuscol).addClass('status-access');\n            } else {\n                $('div#status_col_' + gid).addClass('spinner-border color');\n            }\n        });\n    };\n\n    GoogledocsControl.prototype.initGroupTags = function () {\n\n        $('tbody').find('[data-group-name]').each(function () {\n            $('div#status_col').addClass('spinner-border color');\n        });\n    };\n\n    /**\n     * display created or failed on the table's status column.\n     */\n    GoogledocsControl.prototype.tagDisplay = function (rownumber, creation) {\n        if (creation === true) {\n            $('#file_' + rownumber).html('Created');\n            $('#file_' + rownumber).addClass('status-access');\n\n        } else {\n            $('#file_' + rownumber).addClass('spinner-border color');\n        }\n\n    };\n\n    GoogledocsControl.prototype.failedTag = function (rownumber) {\n        $('#file_' + rownumber).html('Failed');\n    }\n\n\n    /**\n     * Example with file name Grouping_Share and groupings called Even and Odd respectively\n     * Even grouping has groups 2 and 4, Odd has groups 1 and 3\n     * Files created:\n     * 1. Grouping_Share \n     * 2. Grouping_share_odd\n     *     Grouping_Share_Grouping_share_odd_group_1\n     *       Grouping_Share_Grouping_share_odd_group_3\n     * 3. Grouping_share_even\n     *     Grouping_Share_Grouping_share_even_group_2\n     *       Grouping_Share_Grouping_share_even_group_4\n     *\n     * This function process the deletion of the following files:\n     *    Grouping_Share\n     *    Grouping_share_odd\n     *    Grouping_share_even\n     * @returns {undefined}\n     */\n    GoogledocsControl.prototype.delete_file_from_grouping = function () {\n        var self = this;\n        DeleteControl.init(JSON.stringify(self.files_to_erase), self.dist_type);\n        self.files_to_erase = [];\n        self.countCalls = 0;\n    };\n\n\n    GoogledocsControl.prototype.callStudentFileService = function (parentfile_id, group_id = 0) {\n        var self = this;\n\n        Log.debug(\"callStudentFileService\");\n        $('tbody').children().each(function (e) {\n\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            var gid;\n\n            if (self.dist == 'dist_share_same_grouping' || self.dist == 'std_copy_grouping') {\n                gid = $(this).attr('student-grouping-id');\n            } else {\n                gid = $(this).attr('student-group-id');\n            }\n\n            self.create_student_file(e, student_id, student_email, student_name, parentfile_id, gid);\n        });\n\n    };\n\n    GoogledocsControl.prototype.callStudentFileServiceForGroup = function (parentfile_id, group_id, grouping_id = 0) {\n        var self = this;\n        Log.debug(\"Enters to: callStudentFileServiceForGroup\");\n        Log.debug(\"Parent file ID \" + parentfile_id + \"Group ID \" + group_id + \"Grouping ID \" + grouping_id);\n\n        $('tbody#group-members-' + group_id).children().each(function (e) {\n\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            var student_group_id = $(this).attr('student-group-id');\n            if (student_group_id == group_id) {\n                self.create_student_file(e, student_id, student_email, student_name, parentfile_id,\n                    student_group_id, grouping_id);\n\n            }\n        });\n\n    };\n\n\n    GoogledocsControl.prototype.create_student_file = function (rownumber, student_id, student_email,\n        student_name, parentfile_id,\n        student_group_id = 0,\n        student_grouping_id = 0) {\n        var self = this;\n        var folder_id = 0;\n\n        if (self.dist_type != 'group_copy') {\n            $('#file_' + rownumber).addClass('spinner-border color'); // progress bar visible. spinner-border\n        }\n\n        if (self.dist_type == 'std_copy_group'\n            || self.dist_type == 'std_copy_grouping'\n            || self.dist_type == 'std_copy_group_grouping') {\n\n            folder_id = self.get_group_folder_id(student_group_id, self.group_folder_ids);\n            Log.debug(\"create_student_file student_name = \" + student_name);\n            Log.debug(\"create_student_file folder_id = \" + folder_id);\n        }\n\n        Ajax.call([{\n\n            methodname: 'mod_googledocs_create_students_file',\n\n            args: {\n                folder_group_id: folder_id,\n                group_id: student_group_id,\n                grouping_id: student_grouping_id,\n                instance_id: self.instance_id,\n                parentfile_id: parentfile_id,\n                student_email: student_email,\n                student_id: student_id,\n                student_name: student_name\n            },\n\n            done: function (response) {\n                Log.debug(response.url);\n                self.countCalls++;\n                // Add file's link\n\n                var urls = JSON.parse(response.url);\n\n                if (self.dist_type == 'std_copy_group'\n                    || self.dist_type == 'std_copy_grouping'\n                    || self.dist_type == 'std_copy_group_grouping') {\n\n                    self.renderStudentLinks(urls, rownumber);\n\n                } else {\n                    var ref = $('#' + 'link_file_' + rownumber);\n                    $(ref).attr(\"href\", urls[0]);\n                }\n\n                // Remove progress bar and display status\n                if (self.dist_type != 'group_copy') {\n                    self.createdTagHandler($('#file_' + rownumber));\n                }\n\n                self.update_local_storage(); // at least one file is created. then avoid duplicate.\n\n            },\n\n            fail: function (reason) {\n                Log.error(reason);\n                $('#file_' + rownumber).removeClass('spinner-border color');\n                self.failedTag(rownumber);\n            }\n        }]);\n\n\n    };\n\n    // When dist. is each student from X group gets a copy. A student\n    // can get more than one copy.\n    GoogledocsControl.prototype.renderStudentLinks = function (urls, rownumber) {\n        urls.forEach(function (url, index) {\n            Log.debug('addLinks ' + rownumber);\n            var ref = $('#' + 'link_file_' + rownumber);\n            if (index === 0) {\n                $(ref).attr(\"href\", url);\n            } else {\n                var src = $(ref).find(\"img\").attr(\"src\");\n                $(ref).append('<a target=\"_blank\" id=\"link_file_' + rownumber + '\"href=\"' + url + '\" class=\"link_icon\">\\n\\\n                            <img src=\"' + src + '\" class=\"link_icon\"</a>');\n            }\n        }, rownumber);\n    };\n\n    GoogledocsControl.prototype.callGroupFileService = function () {\n\n        var owner_email = $('table.overviewTable').attr('data-owner-email');\n        var self = this;\n\n        $('tbody').find('[data-group-name]').each(function () {\n            self.countCalls++;\n            var group_name = $(this).attr('data-group-name');\n            var groupid = $(this).attr('data-group-id');\n            var a_element = ($(this).find('#shared_link_url_' + groupid))[0]; //It is always the one element.\n            ($(this).find('div#status_col')).addClass('spinner-border color');\n            self.create_group_file(a_element, owner_email, group_name, groupid);\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.callGroupingFileService = function () {\n\n        var self = this;\n        var owner_email = $('table.overviewTable ').attr('data-owner-email');\n        self.create_grouping_file(owner_email);\n    };\n\n    GoogledocsControl.prototype.callGroupGroupingFileService = function () {\n        var owneremail = $('table.overviewTable').attr('data-owner-email');\n        var instanceid = $('table.overviewTable').attr('data-instance-id');\n        var self = this;\n\n        $('tbody').find('[data-g-name]').each(function () {\n            self.countCalls++;\n            var gname = $(this).attr('data-g-name');\n            var gid = $(this).attr('data-g-id');\n            var gtype = $(this).attr('data-g-type');\n            var aelement = ($(this).find('#shared_link_url_' + gid))[0]; //It is always the one element.\n            var statuscol = ($(this).find('#status_col_' + gid));\n            ($(this).find('div#status_col_' + gid)).addClass('spinner-border color');\n            self.create_group_grouping_file(aelement, statuscol, owneremail, instanceid, gname, gid, gtype);\n\n        });\n    };\n\n    /**\n     * Creates the file FileName_Group_Name\n     * @param htmlElement a_element\n     * @param String owner_email\n     * @param String group_name\n     * @param int group_id\n     * @param int parentfile_id\n     * @param int grouping_id\n     *\n     */\n    GoogledocsControl.prototype.create_group_file = function (a_element = '',\n        owner_email, group_name = '', group_id, parentfile_id = 0, grouping_id = 0) {\n\n        var self = this;\n\n        if (!self.grouping_sharing) {\n            parentfile_id = self.parentfile_id;\n        }\n\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_group_file',\n            args: {\n                group_name: group_name,\n                group_id: group_id,\n                grouping_id: grouping_id,\n                instance_id: self.instance_id,\n                owner_email: owner_email,\n                parentfile_id: parentfile_id,\n            },\n            done: function (response) {\n                Log.debug(\"mod_googledocs_create_group_file \" + JSON.stringify(response));\n                if (self.dist_type == 'dist_share_same_group'\n                    || self.dist_type == 'dist_share_same_grouping_copy'\n                    || self.dist_type == 'dist_share_same_group_grouping_copy') {\n                    self.append_links_to_icons(response.url); //  Traverse the list of students and add the link according to the group they belong to.\n                } else {\n                    // Add file's link\n                    $(a_element).attr(\"href\", response.url);\n                    //Returns the ID of the file created for the group.\n                    Log.debug('Group ID ' + group_id);\n                    self.callStudentFileServiceForGroup(response.googledocid, group_id);\n                }\n                if (response.isfoldertype != true) {\n                    self.files_to_erase.push(parentfile_id);\n                }\n\n                self.update_local_storage(); // at least one file is created. then avoid duplicate.\n\n            },\n            fail: function (reason) {\n                Log.error(reason);\n                // TODO: ADD FAIL TAG\n            }\n        }]);\n\n\n    };\n\n    /**\n     * Creates the file FileName_GroupingName for all the groupings selected.\n     * The same url is shared with the members of the grouping groups.\n     * @param String grouping_name\n     * @param  int grouping_id\n     * @param String owner_email\n     */\n    GoogledocsControl.prototype.create_grouping_file = function (owner_email) {\n        var self = this;\n        Log.debug(\"create_grouping_file llamada\");\n\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_grouping_file',\n            args: {\n                owneremail: owner_email,\n                parentfileid: self.parentfile_id,\n            },\n            done: function (response) {\n                Log.debug(response);\n                $('tbody tr').each(function () {\n                    self.countCalls++;\n                    var id = $(this).attr('data-grouping-id');  // Get the grouping id\n                    self.get_grouping_url(id, JSON.parse(response.groupingsurl));\n                });\n\n                self.update_local_storage();\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n    };\n\n    GoogledocsControl.prototype.create_group_grouping_file = function (aelement = '', statuscol = '', owneremail,\n        instanceid, gname, gid, gtype) {\n        var self = this;\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_group_grouping_file',\n            args: {\n                gid: gid,\n                gname: gname,\n                gtype: gtype,\n                instanceid: instanceid,\n                owneremail: owneremail,\n                parentfileid: self.parentfile_id,\n            },\n            done: function (response) {\n                // Add file's link.\n                $(aelement).attr(\"href\", response.url);\n                // Change status.\n                self.createdTagHandler(statuscol);\n                self.update_local_storage(); // at least one file is created. then avoid duplicate.\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n    };\n\n\n    //Dist. Each student from a group gets a copy or each std. from a group share same copy. Create group folders\n    GoogledocsControl.prototype.create_group_folder = function () {\n        var self = this;\n        Log.debug(\"create_group_folder \" + self.instance_id);\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_group_folder_struct',\n            args: {\n                instanceid: self.instance_id,\n            },\n            done: function (response) {\n                Log.debug('mod_googledocs_create_group_folder_struct');\n                self.group_folder_ids = JSON.parse(response.group_folder_ids);\n                // Each student will get a copy.\n                if (self.dist_type == 'std_copy_group'\n                    || self.dist_type == 'std_copy_grouping'\n                    || self.dist_type == 'std_copy_group_grouping') {\n\n                    self.callStudentFileService(self.parentfile_id);\n                }\n\n                // Create the copy and the owner is the teacher.\n                if (self.dist_type == 'dist_share_same_group'\n                    || self.dist_type == 'dist_share_same_grouping_copy'\n                    || self.dist_type == 'dist_share_same_group_grouping_copy') {\n\n                    var g_ids = $('table.overviewTable').attr('data-all-groups');\n                    var owner_email = $('table.overviewTable').attr('data-owner-email');\n                    self.create_group_file('', owner_email, '', g_ids, self.parentfile_id);\n                }\n\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n    };\n\n    GoogledocsControl.prototype.shareSameGroupGroupingService = function () {\n        var self = this;\n        var g_ids = $('table.overviewTable').attr('data-all-groups');\n        var owner_email = $('table.overviewTable').attr('data-owner-email');\n        self.create_group_file('', owner_email, '', g_ids, self.parentfile_id);\n\n    };\n\n    /**\n     * \n     * @param {type} group_id\n     * @param {type} group_folder_ids\n     * @returns {unresolved}\n     */\n    GoogledocsControl.prototype.get_group_folder_id = function (group_id, group_folder_ids) {\n        var groups = group_id.split('-');\n        for (var i = 0; i < group_folder_ids.length; i++) {\n            if (group_folder_ids[i].group_id == group_id || groups.includes(group_folder_ids[i].group_id)) {\n                return group_folder_ids[i].folder_id;\n                break;\n            }\n        }\n\n    };\n\n    /**\n     * Get the URL(s) generated for the grouping with the given id\n     * If a student belongs to more than one grouping, return all the urls\n     * This function is called when the distribution is dist_share_same_grouping      \n     */\n    GoogledocsControl.prototype.get_grouping_url_for_student = function (id, urls, rownumber) {\n        console.log(\"EN get_grouping_url_for_student...\")\n        var ids = id.split('-');\n        var links = [];\n        var self = this;\n\n        for (var i = 0; i < urls.length; i++) {\n\n            if (ids.includes(urls[i].gid)) {\n                links.push(urls[i].url);\n            }\n        }\n        Log.debug(links);\n\n        if (self.dist_type == 'dist_share_same_group') {\n            self.append_links_helper(links, id);\n        } else {\n            self.append_links_helper(links, rownumber);\n\n        }\n    };\n\n    /**\n     * Get the URL generated for the grouping with the given id\n     * This function is called when the distribution is grouping_copy\n     */\n    GoogledocsControl.prototype.get_grouping_url = function (id, urls) {\n\n        var ref = $('#' + 'shared_link_url_' + id);\n        var self = this;\n        for (var i = 0; i < urls.length; i++) {\n            if (id == (urls[i].gid)) {\n                $(ref).attr(\"href\", urls[i].url);\n                var tag = $('#status_col_' + id);\n                self.createdTagHandler(tag);\n                break;\n            }\n        }\n\n    };\n\n    /**\n     * For distributions involving GROUPS\n     * @param {type} urls\n     * @returns {undefined}\n     */\n    GoogledocsControl.prototype.append_links_to_icons = function (urls) {\n        var self = this;\n\n        $('tbody').children().each(function (e) {\n            self.countCalls++;\n            Log.debug('append_links_to_icons');\n            var id = $(this).attr('data-group-id'); //student-group-id\n            if (id != undefined) {\n                self.get_grouping_url_for_student(id, JSON.parse(urls), e);\n            }\n        });\n\n    };\n\n    /**\n     * Add the url in the href property. If the student has more than one\n     * grouping, append new icons\n     * Distribution = dist_share_same_grouping.\n     * @param {type} urls\n     * @param {type} rownumber\n     * @returns {undefined}\n     */\n    GoogledocsControl.prototype.append_links_helper = function (urls, rownumber) {\n        var self = this;\n\n        urls.forEach(function (url, index) {\n            var ref;\n            if (self.dist_type == 'dist_share_same_group') {\n                ref = $('#' + 'shared_link_url_' + rownumber);\n            } else {\n                ref = $('#' + 'link_file_' + rownumber);\n            }\n            var src = $(ref).find(\"img\").attr(\"src\");\n\n            if (index == 0) {\n                $(ref).attr(\"href\", url); // Set link the existing icon\n            } else {\n                $(ref).append('<a target=\"_blank\" id=\"link_file_' + rownumber +\n                    '\"href=\"' + url + '\" class=\"link_icon\">\\n\\ \\n\\\n                <img src=\"' + src + '\" class=\"link_icon\"</a>');\n            }\n\n            $('#file_' + rownumber).removeClass('spinner-border color');\n            self.tagDisplay(rownumber, true);\n        });\n    };\n\n    GoogledocsControl.prototype.update_local_storage = function () {\n        var self = this;\n        const instancecreated = {\n            instanceid: self.instance_id,\n            created: 1\n        }\n        localStorage.setItem('instance', JSON.stringify(instancecreated));\n    }\n\n    return {\n        init: init\n    };\n});"],"file":"create_controls.min.js"}