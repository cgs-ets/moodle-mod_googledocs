{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","GoogledocsControl","parentfile_id","create","group_sharing","instance_id","grouping_sharing","self","prototype","main","callStudentFileService","callGroupFileService","callGroupingFileService","initTags","document","ajaxStop","children","each","tag","find","removeClass","html","addClass","e","attr","tagDisplay","rownumber","creation","student_id","student_email","student_name","create_student_file","callStudentFileServiceForGroup","group_id","grouping_id","student_group_id","by_group","by_grouping","student_grouping_id","call","methodname","args","done","response","debug","url","console","log","ref","fail","reason","error","owner_email","group_name","groupid","a_element","create_group_file","grouping_name","create_grouping_file","googledocid","removeAttr","callGroupingGroupFileService","t","link","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googledocs/control module\n *\n * @package   mod_googledocs\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googledocs/control\n */\ndefine(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n    /**\n     * Initializes the block controls.\n     */\n    function init(create, group_sharing, grouping_sharing) {\n        Log.debug('mod_googledocs/control: initializing controls of the mod_googledocs');\n    \n        var parentfile_id;\n\n        if (grouping_sharing) {\n            parentfile_id = $('table.groupingTable').attr('data-parentfile-id');\n        }else{\n            parentfile_id = $('table.overviewTable').attr('data-googledoc-id');\n        }\n \n        var instance_id = $('table.overviewTable').attr('data-instance-id');\n        var control = new GoogledocsControl(parentfile_id, create, group_sharing, instance_id, grouping_sharing);\n        control.main();\n    }\n\n    // Constructor.\n    function GoogledocsControl( parentfile_id, create, group_sharing, instance_id, grouping_sharing) {\n        var self = this;\n        self.parentfile_id = parentfile_id;\n        self.create = create;\n        self.group_sharing = group_sharing;\n        self.instance_id = instance_id;\n        self.grouping_sharing = grouping_sharing;\n    }\n\n    GoogledocsControl.prototype.main = function () {\n        var self = this;\n\n        // Only call the create service if the files are not created.\n        // This JS is called in the view.php page, which calls the function\n        // that renders the table. It is the same table for created and processing\n        //when sharing by group or by bygrouping other WS is called\n               \n        if(!self.create && !self.group_sharing && !self.grouping_sharing) {\n            self.callStudentFileService(self.parentfile_id);\n        }else if (!self.create && self.group_sharing && !self.grouping_sharing) {\n            self.callGroupFileService();\n        }else if(!self.create && self.grouping_sharing && !self.group_sharing) {\n            self.callGroupingFileService();\n        }else{\n              self.initTags();\n        }\n\n        // When sharing by group or grouping. The same file is shared.\n        // The generation of this file might be quick, but giving the students\n        // a permission can take some time. In order for the entire sharing is done\n        // The progress bar is only removed when all the ajax calls finish.\n        $(document).ajaxStop(function() {\n\n           $('tbody').children().each(function(e){\n            var tag = $(this).find('#status_col');\n            tag.removeClass('progress_bar processing');\n            tag.html('Created');\n            tag.addClass('tag_doc success');\n           });\n\n           if(self.grouping_sharing){\n               $('tbody.grouping-groups td.groups').each(function(){\n                $(this).find('table').each(function(){\n                    var tag = $(this).find(\"#file_grouping\");\n                    tag.removeClass('progress_bar processing');\n                    tag.html('Created');\n                    tag.addClass('tag_doc success');\n                });\n             });\n           }\n        });\n\n    };\n\n    GoogledocsControl.prototype.initTags = function (){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            if ($('#link_file_' + e).attr('href') != '#'){\n                self.tagDisplay(e, true);\n            }else{\n                self.tagDisplay(e, false);\n            }\n        });\n\n    };\n\n\n    /**\n     *\n     * @param {int} rownumber\n     * @param  boolean creation\n     * @returns display created or failed on the table's status column.\n     */\n    GoogledocsControl.prototype.tagDisplay = function(rownumber, creation){\n        var self = this;\n \n        if(creation === true && !self.group_sharing){\n            $('#file_' + rownumber).html('Created');\n            $('#file_' + rownumber).addClass('tag_doc success');\n        }else if(creation === true && self.group_sharing){\n            $('div#status_col').html('Sharing');\n            $('div#status_col').addClass('tag_doc success');\n        }else{\n            $('#file_' + rownumber).html('Failed');\n            $('#file_' + rownumber).addClass('tag_doc failed');\n        }\n\n    };\n\n    GoogledocsControl.prototype.callStudentFileService = function(parentfile_id){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            self.create_student_file(e, student_id, student_email, student_name, parentfile_id);\n\n        });\n    };\n\n    GoogledocsControl.prototype.callStudentFileServiceForGroup = function(parentfile_id, group_id, grouping_id = 0) {\n        var self = this;\n\n        $('tbody#group-members-'+group_id).children().each(function(e){\n\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            var student_group_id = $(this).attr('student-group-id');\n            if(student_group_id == group_id) {\n                self.create_student_file(e, student_id, student_email, student_name, parentfile_id,\n                                         self.group_sharing, student_group_id, self.grouping_sharing, grouping_id );\n            }\n        });\n\n    };\n\n\n    GoogledocsControl.prototype.create_student_file = function (rownumber, student_id, student_email,student_name, parentfile_id, \n                                                                by_group = false, student_group_id = 0, by_grouping = false,\n                                                                student_grouping_id = 0) {\n        var self = this;\n\n        if(!by_group) {\n           $('#file_' + rownumber).addClass('progress_bar processing'); // progress bar visible.\n        }\n\n        Ajax.call([{\n\n                methodname: 'mod_googledocs_create_students_file',\n\n                args: {\n                    by_group : by_group,\n                    by_grouping: by_grouping,\n                    group_id : student_group_id,\n                    grouping_id: student_grouping_id,\n                    instance_id : self.instance_id,\n                    parentfile_id: parentfile_id,\n                    student_email: student_email,\n                    student_id: student_id,\n                    student_name: student_name\n                },\n\n                done: function (response) {\n                    Log.debug(response.url);\n                    console.log(\"rownumber: \" + rownumber );\n                    // Add file's link\n                    var ref = $('#' + 'link_file_' + rownumber);\n                    $(ref).attr(\"href\", response.url);\n                    // Remove progress bar and display status\n                    if(!by_group) {\n                        $('#file_' + rownumber).removeClass('progress_bar processing');\n                        self.tagDisplay(rownumber, true);\n                    }\n                },\n\n                fail: function (reason) {\n                    Log.error(reason);\n                    $('#file_' + rownumber).removeClass('progress_bar  processing');\n                    self.tagDisplay(rownumber, false);\n                }\n            }]);\n\n    };\n\n    GoogledocsControl.prototype.callGroupFileService = function (){\n\n        var owner_email = $('table.overviewTable').attr('data-owner-email');\n        var self = this;\n        $('tbody').find('[data-group-name]').each(function(e){\n            var group_name = $(this).attr('data-group-name');\n            var groupid =   $(this).attr('data-group-id');\n            var a_element = ($(this).find('#shared_link_url_' + groupid))[0]; //It is always the one element.\n           ($(this).find('div#status_col')).addClass('progress_bar processing');\n            self.create_group_file(a_element, owner_email, group_name, groupid);\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.callGroupingFileService = function (){\n        \n        $('tbody.grouping-groups td.groups').each(function(){\n           $(this).find('table').each(function(){\n                ($(this).find(\"#file_grouping\")).addClass('progress_bar processing');\n           });\n        });\n\n        var owner_email = $('table.groupingTable').attr('data-owner-email');\n\n        var self = this;\n        $('tbody').find('[data-grouping-name]').each(function(e){\n            var grouping_name = $(this).attr('data-grouping-name');\n            var grouping_id =   $(this).attr('data-grouping-id');\n            self.create_grouping_file (grouping_name, grouping_id, owner_email);\n        });\n\n    };\n    /**\n     * Creates the file FileName_Group_Name\n     * @param htmlElement a_element\n     * @param String owner_email\n     * @param String group_name\n     * @param int group_id\n     * @param int parentfile_id\n     * @param int grouping_id\n     *\n     */\n    GoogledocsControl.prototype.create_group_file = function(a_element ,owner_email, group_name, group_id, parentfile_id = 0,\n    grouping_id = 0){\n\n        var self = this;\n        \n        if(!self.grouping_sharing) {\n            parentfile_id = self.parentfile_id;\n        }\n       \n        console.log('create_group_file' + \" \" +owner_email + \" \" + group_name + \" \" + parentfile_id);\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_group_file',\n            args: {\n                group_name: group_name,\n                group_id: group_id,\n                grouping_id: grouping_id,\n                instance_id: self.instance_id,\n                owner_email: owner_email,\n                parentfile_id: parentfile_id,\n            },\n            done: function (response) {\n                console.log(response);\n                 // Add file's link\n                $(a_element).attr(\"href\", response.url);\n                //Returns the ID of the file created for the group.\n                self.callStudentFileServiceForGroup(response.googledocid, group_id);\n\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n\n        $('table.overviewTable').removeAttr('data-googledoc-id');\n\n    };\n    /**\n     * Creates the file FileName_GroupingName\n     * @param String grouping_name\n     * @param  int grouping_id\n     * @param String owner_email\n     *\n     */\n    GoogledocsControl.prototype.create_grouping_file = function (grouping_name, grouping_id, owner_email) {\n        var self = this;\n        console.log(\"create_grouping_file. Attr:  \" + grouping_name + \" \" + grouping_id + \" \" + owner_email);\n        Ajax.call([{\n            methodname: 'mod_googledocs_create_grouping_file',\n            args: {\n                grouping_name: grouping_name,\n                grouping_id: grouping_id,\n                owner_email: owner_email,\n                parentfile_id: self.parentfile_id,\n            },\n            done: function (response) {\n                console.log(response);\n                // Add file's link\n               // $(a_element).attr(\"href\", response.url);\n                //Returns the ID of the file created for the groups.\n                //self.callStudentFileServiceForGrouping(response.googledocid, grouping_id);\n                self.callGroupingGroupFileService(response.googledocid, grouping_id, response.url); // We need to create the file for the groups\n\n            },\n            fail: function (reason) {\n                Log.error(reason);\n            }\n        }]);\n\n      //  $('table.groupingTable').removeAttr('data-googledoc-id');\n    };\n    \n   /**\n    * Creates the file FileName_GroupingName_GroupName\n    * @param int parentfile_id\n    * @param int grouping_id\n    * @param url url\n    * \n    */\n    GoogledocsControl.prototype.callGroupingGroupFileService = function(parentfile_id, grouping_id, url){\n        var self = this;\n\n       $('tbody.grouping-groups td.groups').each(function(){\n            $(this).find('table').each(function(){\n                var t = $(this);\n                var group_id = t.attr('data-group-id');\n                var owner_email = t.attr('data-owner-email');\n                var group_name = t.attr('data-group-name');\n                var link = (t.find('#shared_link_' + grouping_id))[0];\n                $(link).attr(\"href\",url);\n                if(t.attr('data-grouping-id') == grouping_id) {\n                    self.create_group_file(link, owner_email, group_name, group_id, parentfile_id, grouping_id );\n                }\n            });\n\n        });\n    };\n\n    return {\n        init: init\n    };\n });"],"file":"controls.min.js"}