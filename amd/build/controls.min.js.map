{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","GoogledocsControl","saveAndDisplay","parentfile_id","create","self","prototype","main","processingMessageDisplay","saveAndReturn","callService","initTags","children","each","e","attr","tagDisplay","rownumber","creation","html","addClass","buttonId","on","appendTo","student_id","find","student_email","student_name","create_student_file","call","methodname","args","done","response","debug","url","ref","removeClass","fail","reason","error","init","control"],"mappings":"AA2BAA,OAAM,2BAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,WAAvB,CAAD,CAAsC,SAAUC,CAAV,CAAaC,CAAb,CAAkBC,CAAlB,CAAwB,CAChE,aAaA,QAASC,CAAAA,CAAT,CAA2BC,CAA3B,CAA2CC,CAA3C,CAA0DC,CAA1D,CAAkE,CAC9D,GAAIC,CAAAA,CAAI,CAAG,IAAX,CACAA,CAAI,CAACF,aAAL,CAAqBA,CAArB,CACAE,CAAI,CAACH,cAAL,CAAsBA,CAAtB,CACAG,CAAI,CAACD,MAAL,CAAcA,CACjB,CAEDH,CAAiB,CAACK,SAAlB,CAA4BC,IAA5B,CAAmC,UAAY,CAC3C,GAAIF,CAAAA,CAAI,CAAG,IAAX,CACAA,CAAI,CAACG,wBAAL,CAA8BH,CAAI,CAACI,aAAnC,EAKA,GAAG,CAACJ,CAAI,CAACD,MAAT,CAAiB,CACbC,CAAI,CAACK,WAAL,EACH,CAFD,IAEK,CACCL,CAAI,CAACM,QAAL,EACL,CAEJ,CAbD,CAeAV,CAAiB,CAACK,SAAlB,CAA4BK,QAA5B,CAAuC,UAAW,CAC9C,GAAIN,CAAAA,CAAI,CAAG,IAAX,CACAP,CAAC,CAAC,OAAD,CAAD,CAAWc,QAAX,GAAsBC,IAAtB,CAA2B,SAASC,CAAT,CAAW,CAClC,GAAyC,GAArC,EAAAhB,CAAC,CAAC,cAAgBgB,CAAjB,CAAD,CAAqBC,IAArB,CAA0B,MAA1B,CAAJ,CAA6C,CACzCV,CAAI,CAACW,UAAL,CAAgBF,CAAhB,IACH,CAFD,IAEK,CACDT,CAAI,CAACW,UAAL,CAAgBF,CAAhB,IACH,CACJ,CAND,CAOH,CATD,CAgBAb,CAAiB,CAACK,SAAlB,CAA4BU,UAA5B,CAAyC,SAASC,CAAT,CAAoBC,CAApB,CAA6B,CAElE,GAAG,KAAAA,CAAH,CAAqB,CACjBpB,CAAC,CAAC,SAAWmB,CAAZ,CAAD,CAAwBE,IAAxB,CAA6B,SAA7B,EACArB,CAAC,CAAC,SAAWmB,CAAZ,CAAD,CAAwBG,QAAxB,CAAiC,iBAAjC,CACH,CAHD,IAGK,CACDtB,CAAC,CAAC,SAAWmB,CAAZ,CAAD,CAAwBE,IAAxB,CAA6B,QAA7B,EACArB,CAAC,CAAC,SAAWmB,CAAZ,CAAD,CAAwBG,QAAxB,CAAiC,gBAAjC,CACH,CACJ,CATD,CAWAnB,CAAiB,CAACK,SAAlB,CAA4BE,wBAA5B,CAAuD,SAASa,CAAT,CAAmB,CAGtEvB,CAAC,CAACuB,CAAD,CAAD,CAAYC,EAAZ,CAAe,OAAf,CAAwB,UAAW,CAC/BxB,CAAC,oMAAD,CAQyByB,QARzB,CAQkC,eARlC,CAUC,CAXL,CAYH,CAfD,CAgBAtB,CAAiB,CAACK,SAAlB,CAA4BI,WAA5B,CAA0C,UAAU,CAChD,GAAIL,CAAAA,CAAI,CAAG,IAAX,CAEAP,CAAC,CAAC,OAAD,CAAD,CAAWc,QAAX,GAAsBC,IAAtB,CAA2B,SAASC,CAAT,CAAW,CAClC,GAAIU,CAAAA,CAAU,CAAG1B,CAAC,CAAC,IAAD,CAAD,CAAQ2B,IAAR,CAAa,SAAWX,CAAxB,EAA2BC,IAA3B,CAAgC,iBAAhC,CAAjB,CACA,GAAyB,WAArB,QAAOS,CAAAA,CAAX,CAAqC,IAC7BE,CAAAA,CAAa,CAAG5B,CAAC,CAAC,IAAD,CAAD,CAAQ2B,IAAR,CAAa,SAAWX,CAAxB,EAA2BC,IAA3B,CAAgC,oBAAhC,CADa,CAE7BY,CAAY,CAAI7B,CAAC,CAAC,IAAD,CAAD,CAAQ2B,IAAR,CAAa,cAAgBD,CAA7B,EAAyCL,IAAzC,EAFa,CAGjCd,CAAI,CAACuB,mBAAL,CAAyBd,CAAzB,CAA4BU,CAA5B,CAAwCE,CAAxC,CAAuDC,CAAvD,CACH,CACJ,CAPD,CAQH,CAXD,CAaA1B,CAAiB,CAACK,SAAlB,CAA4BsB,mBAA5B,CAAkD,SAAUX,CAAV,CAAqBO,CAArB,CAAiCE,CAAjC,CAAgDC,CAAhD,CAA8D,CAC5G,GAAItB,CAAAA,CAAI,CAAG,IAAX,CACAP,CAAC,CAAC,SAAWmB,CAAZ,CAAD,CAAwBG,QAAxB,CAAiC,yBAAjC,EAEApB,CAAI,CAAC6B,IAAL,CAAU,CAAC,CACHC,UAAU,CAAE,qCADT,CAEHC,IAAI,CAAE,CACF5B,aAAa,CAAEE,CAAI,CAACF,aADlB,CAEFuB,aAAa,CAAEA,CAFb,CAGFC,YAAY,CAAEA,CAHZ,CAIFH,UAAU,CAAEA,CAJV,CAFH,CAQHQ,IAAI,CAAE,cAAUC,CAAV,CAAoB,CACtBlC,CAAG,CAACmC,KAAJ,CAAUD,CAAQ,CAACE,GAAnB,EAEA,GAAIC,CAAAA,CAAG,CAAGtC,CAAC,CAAC,cAAqBmB,CAAtB,CAAX,CACAnB,CAAC,CAACsC,CAAD,CAAD,CAAOrB,IAAP,CAAY,MAAZ,CAAoBkB,CAAQ,CAACE,GAA7B,EAEArC,CAAC,CAAC,SAAWmB,CAAZ,CAAD,CAAwBoB,WAAxB,CAAoC,yBAApC,EACAhC,CAAI,CAACW,UAAL,CAAgBC,CAAhB,IAGH,CAlBE,CAmBHqB,IAAI,CAAE,cAAUC,CAAV,CAAkB,CACpBxC,CAAG,CAACyC,KAAJ,CAAUD,CAAV,EACAzC,CAAC,CAAC,SAAWmB,CAAZ,CAAD,CAAwBoB,WAAxB,CAAoC,0BAApC,EACAhC,CAAI,CAACW,UAAL,CAAgBC,CAAhB,IACH,CAvBE,CAAD,CAAV,CAyBH,CA7BD,CA+BI,MAAO,CACHwB,IAAI,CAvHZ,SAAcrC,CAAd,CAAsB,CAClBL,CAAG,CAACmC,KAAJ,CAAU,qEAAV,EADkB,GAGd/B,CAAAA,CAAa,CAAGL,CAAC,CAAC,qBAAD,CAAD,CAAyBiB,IAAzB,CAA8B,mBAA9B,CAHF,CAId2B,CAAO,CAAG,GAAIzC,CAAAA,CAAJ,oBAAsCE,CAAtC,CAAqDC,CAArD,CAJI,CAKlBsC,CAAO,CAACnC,IAAR,EACH,CAgHU,CAGb,CA9HI,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googledocs/control module\n *\n * @package   mod_googledocs\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googledocs/control\n */\ndefine(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n    /**\n     * Initializes the block controls.\n     */\n    function init(create) {\n        Log.debug('mod_googledocs/control: initializing controls of the mod_googledocs');\n        var saveAndDisplay = '#id_submitbutton';\n        var parentfile_id = $('table.overviewTable').attr('data-googledoc-id');\n        var control = new GoogledocsControl(saveAndDisplay, parentfile_id, create);\n        control.main();\n    }\n\n    // Constructor.\n    function GoogledocsControl(saveAndDisplay, parentfile_id, create) {\n        var self = this;\n        self.parentfile_id = parentfile_id;\n        self.saveAndDisplay = saveAndDisplay;\n        self.create = create;\n    }\n\n    GoogledocsControl.prototype.main = function () {\n        var self = this;\n        self.processingMessageDisplay(self.saveAndReturn);\n        // Only call the create service if the files are not created.\n        // This JS is called in the view.php page, which calls the function\n        // that renders the table. It is the same table for created and processing\n       \n        if(!self.create) {\n            self.callService();\n        }else{\n              self.initTags();\n        }\n\n    };\n    \n    GoogledocsControl.prototype.initTags = function (){\n        var self = this;\n        $('tbody').children().each(function(e){\n            if ($('#link_file_' + e).attr('href') != '#'){\n                self.tagDisplay(e, true);\n            }else{\n                self.tagDisplay(e, false);\n            }\n        });\n    };\n    /**\n     *\n     * @param {int} rownumber\n     * @param  boolean creation\n     * @returns display created or failed on the table's status column.\n     */\n    GoogledocsControl.prototype.tagDisplay = function(rownumber, creation){\n\n        if(creation === true){\n            $('#file_' + rownumber).html('Created');\n            $('#file_' + rownumber).addClass('tag_doc success');\n        }else{\n            $('#file_' + rownumber).html('Failed');\n            $('#file_' + rownumber).addClass('tag_doc failed');\n        }\n    };\n\n    GoogledocsControl.prototype.processingMessageDisplay = function(buttonId) {\n        // Handle submit click.\n\n        $(buttonId).on('click', function() {\n            $(\"<div class='d-flex flex-column align-items-center justify-content-center overlay'>\"\n                + \"<div class='spinner-border processing' role='status'>\"\n                + \"<span class='sr-only'>Loading...</span>\"\n                + \"</div>\"\n//                + \"<div class = 'process_message'>\\n\\\n//                    <p>Saving files into My Drive. <br>\\n\\\n//                        The process can take sometime.<br> \\n\\\n//                        Please do not close the browser.</p>\\n\\\n                 +   \"</div></div>\").appendTo('#page-content');\n\n            });\n    };\n    GoogledocsControl.prototype.callService = function(){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            var student_id = $(this).find('#file_' + e).attr('data-student-id');\n            if (typeof student_id != \"undefined\"){\n                var student_email=  $(this).find('#file_' + e).attr('data-student-email');\n                var student_name =  $(this).find('a#fullname_' + student_id).html();\n                self.create_student_file(e, student_id, student_email, student_name);\n            }\n        });\n    };\n\n    GoogledocsControl.prototype.create_student_file = function (rownumber, student_id, student_email, student_name) {\n        var self = this;\n        $('#file_' + rownumber).addClass('progress_bar processing'); // progress bar visible.\n       \n        Ajax.call([{\n                methodname: 'mod_googledocs_create_students_file',\n                args: {\n                    parentfile_id: self.parentfile_id,\n                    student_email: student_email,\n                    student_name: student_name,\n                    student_id: student_id,\n                },\n                done: function (response) {\n                    Log.debug(response.url);\n                    // Add file's link\n                    var ref = $('#' + 'link_file_' + rownumber);\n                    $(ref).attr(\"href\", response.url);\n                    // Remove progress bar and display status\n                    $('#file_' + rownumber).removeClass('progress_bar processing');\n                    self.tagDisplay(rownumber, true);\n\n\n                },\n                fail: function (reason) {\n                    Log.error(reason);\n                    $('#file_' + rownumber).removeClass('progress_bar  processing');\n                    self.tagDisplay(rownumber, false);\n                }\n            }]);\n    };\n\n        return {\n            init: init\n        };\n });"],"file":"controls.min.js"}