{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","GoogledocsControl","parentfile_id","create","group_sharing","instance_id","self","prototype","main","callStudentFileService","callGroupFileService","initTags","initTagsByGroup","initTagsByStudent","children","each","e","attr","tagDisplay","rownumber","creation","html","addClass","by_group","group_id","student_id","student_email","student_name","create_student_file","callStudentFileServiceForByGroup","student_group_id","call","methodname","args","done","response","debug","url","console","log","ref","removeClass","fail","reason","error","owner_email","find","group_name","groupid","create_group_file","googledocid","removeAttr","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googledocs/control module\n *\n * @package   mod_googledocs\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googledocs/control\n */\ndefine(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n    /**\n     * Initializes the block controls.\n     */\n    function init(create, group_sharing) {\n        Log.debug('mod_googledocs/control: initializing controls of the mod_googledocs');\n        \n        var parentfile_id = $('table.overviewTable').attr('data-googledoc-id');\n        var instance_id = $('table.overviewTable').attr('data-instance-id');\n        var control = new GoogledocsControl(parentfile_id, create, group_sharing, instance_id);\n        control.main();\n    }\n\n    // Constructor.\n    function GoogledocsControl( parentfile_id, create, group_sharing, instance_id) {\n        var self = this;\n        self.parentfile_id = parentfile_id;\n        self.create = create;\n        self.group_sharing = group_sharing;\n        self.instance_id = instance_id;\n    }\n\n    GoogledocsControl.prototype.main = function () {\n        var self = this;\n\n        // Only call the create service if the files are not created.\n        // This JS is called in the view.php page, which calls the function\n        // that renders the table. It is the same table for created and processing\n        //when sharing by group another WS is called\n        if(!self.create && !self.group_sharing) {\n            self.callStudentFileService(self.parentfile_id);\n        }else if (!self.create && self.group_sharing) {\n            self.callGroupFileService();\n        }else{\n              self.initTags();\n        }\n\n    };\n\n    GoogledocsControl.prototype.initTags = function (){\n        var self = this;\n        \n        if(self.group_sharing){\n            self.initTagsByGroup();\n        }else{\n            self.initTagsByStudent();\n        }\n\n    };\n\n    GoogledocsControl.prototype.initTagsByStudent = function (){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            if ($('#link_file_' + e).attr('href') != '#'){\n                self.tagDisplay(e, true);\n            }else{\n                self.tagDisplay(e, false);\n            }\n        });\n    };\n\n    GoogledocsControl.prototype.initTagsByGroup = function (){\n        var self = this;\n\n        $('tbody#group-members').children().each(function(e){\n            if ($('#link_file_' + e).attr('href') != '#'){\n                self.tagDisplay(e, true);\n            }else{\n                self.tagDisplay(e, false);\n            }\n        });\n    };\n    /**\n     *\n     * @param {int} rownumber\n     * @param  boolean creation\n     * @returns display created or failed on the table's status column.\n     */\n    GoogledocsControl.prototype.tagDisplay = function(rownumber, creation){\n\n        if(creation === true){\n            $('#file_' + rownumber).html('Created');\n            $('#file_' + rownumber).addClass('tag_doc success');\n        }else{\n            $('#file_' + rownumber).html('Failed');\n            $('#file_' + rownumber).addClass('tag_doc failed');\n        }\n    };\n\n    GoogledocsControl.prototype.callStudentFileService = function(parentfile_id, by_group = false, group_id = 0){\n        var self = this;\n       \n        $('tbody').children().each(function(e){\n            var student_id = $(this).attr('data-student-id');  \n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            self.create_student_file(e, student_id, student_email, student_name, parentfile_id);\n\n        });\n    };\n\n    GoogledocsControl.prototype.callStudentFileServiceForByGroup =function(parentfile_id, group_id) {\n        var self = this;\n        $('tbody#group-members').children().each(function(e){\n            var student_id = $(this).attr('data-student-id');\n            var student_email = $(this).attr('data-student-email');\n            var student_name = $(this).attr('student-name');\n            var student_group_id = $(this).attr('student-group-id');\n\n            if(student_group_id == group_id) {\n                 self.create_student_file(e, student_id, student_email, student_name, parentfile_id, true, student_group_id);\n            }\n\n        });\n\n    };\n\n    GoogledocsControl.prototype.create_student_file = function (rownumber, student_id, student_email,student_name, parentfile_id, \n                                                                by_group = false, student_group_id = 0) {\n        var self = this;\n        $('#file_' + rownumber).addClass('progress_bar processing'); // progress bar visible.\n\n        Ajax.call([{\n                methodname: 'mod_googledocs_create_students_file',\n                args: {\n                    by_group : by_group,\n                    group_id : student_group_id,\n                    instance_id : self.instance_id,\n                    parentfile_id: parentfile_id,\n                    student_email: student_email,\n                    student_id: student_id,\n                    student_name: student_name\n                },\n                done: function (response) {\n                    Log.debug(response.url);\n                    console.log(\"rownumber: \" + rownumber );\n                    // Add file's link\n                    var ref = $('#' + 'link_file_' + rownumber);\n                    $(ref).attr(\"href\", response.url);\n                    // Remove progress bar and display status\n                    $('#file_' + rownumber).removeClass('progress_bar processing');\n                    self.tagDisplay(rownumber, true);\n\n\n                },\n                fail: function (reason) {\n                    Log.error(reason);\n                    $('#file_' + rownumber).removeClass('progress_bar  processing');\n                    self.tagDisplay(rownumber, false);\n                }\n            }]);\n    };\n\n    GoogledocsControl.prototype.callGroupFileService = function (){\n        //Add the progress bar\n        $('tbody#group-members').children().each(function(e){\n             $('#file_' + e).addClass('progress_bar processing')\n        });\n        \n        var owner_email = $('table.overviewTable').attr('data-owner-email');\n        var self = this;\n        $('tbody').find('[ data-group-name]').each(function(e){\n            var group_name = $(this).attr('data-group-name');\n            var groupid =   $(this).attr('data-group-id');\n            self.create_group_file(owner_email, group_name, groupid);\n        });\n\n    };\n\n    GoogledocsControl.prototype.create_group_file = function(owner_email, group_name, group_id){\n\n        var self = this;\n          Ajax.call([{\n                methodname: 'mod_googledocs_create_group_file',\n                args: {\n                    group_name: group_name,\n                    group_id: group_id,\n                    owner_email: owner_email,\n                    parentfile_id: self.parentfile_id,\n                },\n                done: function (response) {\n                    console.log(response);\n                    //Returns the ID of the file created for the group.   \n                    self.callStudentFileServiceForByGroup(response.googledocid, group_id);\n                },\n                fail: function (reason) {\n                    Log.error(reason);\n                }\n            }]);\n\n        $('table.overviewTable').removeAttr('data-googledoc-id'); \n\n    };\n\n        return {\n            init: init\n        };\n });"],"file":"controls.min.js"}