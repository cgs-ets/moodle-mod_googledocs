{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","GoogledocsControl","parentfile_id","create","self","prototype","main","callService","initTags","children","each","e","attr","tagDisplay","rownumber","creation","html","addClass","student_id","find","student_email","student_name","create_student_file","call","methodname","args","done","response","debug","url","ref","removeClass","fail","reason","error","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the mod_googledocs/control module\n *\n * @package   mod_googledocs\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_googledocs/control\n */\ndefine(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n    /**\n     * Initializes the block controls.\n     */\n    function init(create) {\n        Log.debug('mod_googledocs/control: initializing controls of the mod_googledocs');\n       \n        var parentfile_id = $('table.overviewTable').attr('data-googledoc-id');\n        var control = new GoogledocsControl(parentfile_id, create);\n        control.main();\n    }\n\n    // Constructor.\n    function GoogledocsControl( parentfile_id, create) {\n        var self = this;\n        self.parentfile_id = parentfile_id;\n        self.create = create;\n    }\n\n    GoogledocsControl.prototype.main = function () {\n        var self = this;\n      \n        // Only call the create service if the files are not created.\n        // This JS is called in the view.php page, which calls the function\n        // that renders the table. It is the same table for created and processing\n       \n        if(!self.create) {\n            self.callService();\n        }else{\n              self.initTags();\n        }\n\n    };\n    \n    GoogledocsControl.prototype.initTags = function (){\n        var self = this;\n        $('tbody').children().each(function(e){\n            if ($('#link_file_' + e).attr('href') != '#'){\n                self.tagDisplay(e, true);\n            }else{\n                self.tagDisplay(e, false);\n            }\n        });\n    };\n    /**\n     *\n     * @param {int} rownumber\n     * @param  boolean creation\n     * @returns display created or failed on the table's status column.\n     */\n    GoogledocsControl.prototype.tagDisplay = function(rownumber, creation){\n\n        if(creation === true){\n            $('#file_' + rownumber).html('Created');\n            $('#file_' + rownumber).addClass('tag_doc success');\n        }else{\n            $('#file_' + rownumber).html('Failed');\n            $('#file_' + rownumber).addClass('tag_doc failed');\n        }\n    };\n\n    GoogledocsControl.prototype.callService = function(){\n        var self = this;\n\n        $('tbody').children().each(function(e){\n            var student_id = $(this).find('#file_' + e).attr('data-student-id');\n            if (typeof student_id != \"undefined\"){\n                var student_email=  $(this).find('#file_' + e).attr('data-student-email');\n                var student_name =  $(this).find('a#fullname_' + student_id).html();\n                self.create_student_file(e, student_id, student_email, student_name);\n            }\n        });\n    };\n\n    GoogledocsControl.prototype.create_student_file = function (rownumber, student_id, student_email, student_name) {\n        var self = this;\n        $('#file_' + rownumber).addClass('progress_bar processing'); // progress bar visible.\n\n        Ajax.call([{\n                methodname: 'mod_googledocs_create_students_file',\n                args: {\n                    parentfile_id: self.parentfile_id,\n                    student_email: student_email,\n                    student_name: student_name,\n                    student_id: student_id,\n                },\n                done: function (response) {\n                    Log.debug(response.url);\n                    // Add file's link\n                    var ref = $('#' + 'link_file_' + rownumber);\n                    $(ref).attr(\"href\", response.url);\n                    // Remove progress bar and display status\n                    $('#file_' + rownumber).removeClass('progress_bar processing');\n                    self.tagDisplay(rownumber, true);\n\n\n                },\n                fail: function (reason) {\n                    Log.error(reason);\n                    $('#file_' + rownumber).removeClass('progress_bar  processing');\n                    self.tagDisplay(rownumber, false);\n                }\n            }]);\n    };\n\n        return {\n            init: init\n        };\n });"],"file":"controls.min.js"}