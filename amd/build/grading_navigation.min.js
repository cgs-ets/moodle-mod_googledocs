define ("mod_googledocs/grading_navigation",["jquery","core/notification","core/ajax","core/str","mod_googledocs/save_grading","mod_googledocs/grading_form_change_check"],function(a,b,c,d,e,f){var g=function(b){console.log(" GradingNavigation constructor....");this._regionSelector=b;this._region=a(b);this._users=[];this._gradeFeedbackChanged=!1;this._loadAllUsers();f.saveFormState("#gradeform");this._region.find("[data-action=\"previous-user\"]").on("click",this._handlePreviousUser.bind(this));this._region.find("[data-action=\"next-user\"]").on("click",this._handleNextUser.bind(this));this._region.find("[data-action=\"change-user\"]").on("change",this._refreshView.bind(this));a(document).find("[data-region=\"googledoc-info\"]").on("click",this._leavepanel.bind(this))};g.prototype._isLoading=!1;g.prototype._regionSelector=null;g.prototype._filters=null;g.prototype._users=null;g.prototype._region=null;g.prototype._gradeFeedbackChanged=null;g.prototype._loadAllUsers=function(){var a=this._region.find("[data-action=change-user]"),d=a.attr("data-googledocid"),e=a.attr("data-groupid");c.call([{methodname:"mod_googledocs_get_participants",args:{googledocid:d,groupid:e},done:this._setUsers.bind(this),fail:b.exception}]);return!0};g.prototype._setUsers=function(a){this._users=JSON.parse(a.users)};g.prototype._handlePreviousUser=function(b){b.preventDefault();if(f.checkFormForChanges("#gradeform")){this._handleChangeUserHelper(b)}else{var c=a("select.custom-select option").filter(":selected").val();this._handlePreviousUser_helper(c);c=a("select.custom-select option").filter(":selected").val();c=parseInt(c,10);this._refreshView(b,c,!0)}};g.prototype._handlePreviousUser_helper=function(b){a(".custom-select option:selected").prev().attr("selected","selected");a("select.custom-select option[value='".concat(b,"']")).removeAttr("selected")};g.prototype._handleNextUser=function(b){b.preventDefault();var c=a(".custom-select option:selected").val(),d=a("select.custom-select option:last-child").val();if(f.checkFormForChanges("#gradeform")){if(c==d){this._handleChangeUserHelper(0)}else{this._handleChangeUserHelper(b)}}else{if(c!=d){this._handleNextUser_helper(c);var e=a("select.custom-select option").filter(":selected").val();this._refreshView(b,e,!0)}}};g.prototype._handleNextUser_helper=function(b){a("select.custom-select option:selected").next().attr("selected","selected");a("select.custom-select option[value='".concat(b,"']")).removeAttr("selected")};g.prototype.update_url=function(a){var b=new URL(window.location);b.searchParams.get("userid");b.searchParams.set("userid",a);window.history.replaceState({},"",b)};g.prototype._refreshView=function(b,c,d){c=d?c:b.target.value;if(0==c){a(".select.custom-select").val(c)}c=parseInt(c,10);if(f.checkFormForChanges("#gradeform")){this._handleChangeUserHelper(c)}else{a(document).trigger("user-changed",c);g.prototype.get_user_by_id(c);g.prototype.update_url(c)}};g.prototype.get_user_by_id=function(b){var d=a("[data-region=\"user-info\"]").data("googledocid")+"";c.call([{methodname:"mod_googledocs_get_next_participant_details",args:{userid:b,googledocid:d},done:function done(b){var c=a("[data-region=\"grade\"]");c.fadeOut(300,function(){c.replaceWith(b.html);c.show();a("#gradeform").on("submit",e.init());f.saveFormState("#gradeform")})},fail:function fail(a){console.log("mod_googledocs_get_participant_by_id. Unable to get elements");console.log(a)}}])};g.prototype._leavepanel=function(c){var e=c.target.closest("a"),g=e.getAttribute("href");if(f.checkFormForChanges("#gradeform")){c.preventDefault();d.get_strings([{key:"unsavedchanges",component:"mod_googledocs"},{key:"unsavedchangesquestion",component:"mod_googledocs"},{key:"saveandcontinue",component:"mod_googledocs"},{key:"cancel",component:"core"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){a("#gradeform").trigger("submit",[{direction:g}])},function(){console.log("False clicked")})})}};g.prototype._handleChangeUserHelper=function(c){d.get_strings([{key:"unsavedchanges",component:"mod_googledocs"},{key:"unsavedchangesquestion",component:"mod_googledocs"},{key:"saveandcontinue",component:"mod_googledocs"},{key:"cancel",component:"core"}]).done(function(d){b.confirm(d[0],d[1],d[2],d[3],function(){if(c.target!=void 0){a("#gradeform").trigger("submit",[{direction:c.target.className}])}else{a("#gradeform").trigger("submit",[{userid:c}])}},function(){console.log("False clicked")})})};return g});
//# sourceMappingURL=grading_navigation.min.js.map
